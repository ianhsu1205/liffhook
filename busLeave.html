<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç·šä¸Šç°½æ ¸</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/zh-tw.min.js"></script>
    <style>
      body {
        font-family: "Noto Sans TC", Arial, sans-serif;
        background-color: #f7f7f7;
        margin: 0;
        padding: 0;
        color: #333;
      }
      .container {
        max-width: 800px;
        margin: 30px auto;
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }
      h2 {
        color: #06c755;
        text-align: center;
        margin-bottom: 25px;
        font-weight: 600;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 15px;
      }
      .form-group {
        margin-bottom: 20px;
        text-align: left;
        position: relative;
      }
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
        color: #555;
      }
      .required::after {
        content: "*";
        color: #e74c3c;
        margin-left: 4px;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        transition: border 0.3s;
        box-sizing: border-box;
      }
      textarea {
        min-height: 100px;
        resize: vertical;
      }
      input:focus,
      select:focus,
      textarea:focus {
        border-color: #06c755;
        outline: none;
        box-shadow: 0 0 0 2px rgba(6, 199, 85, 0.1);
      }
      input.error,
      select.error,
      textarea.error {
        border-color: #e74c3c;
      }
      .error-tooltip {
        position: absolute;
        background-color: #e74c3c;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 14px;
        z-index: 100;
        bottom: calc(100% + 5px);
        left: 0;
        width: auto;
        white-space: nowrap;
        display: none;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
      }
      .error-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 15px;
        border-width: 5px;
        border-style: solid;
        border-color: #e74c3c transparent transparent transparent;
      }
      .button {
        width: 100%;
        padding: 14px;
        background-color: #06c755;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 10px;
      }
      .button:hover {
        background-color: #04a73e;
        box-shadow: 0 4px 8px rgba(6, 199, 85, 0.2);
      }
      .button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .secondary-button {
        background-color: #f1f1f1;
        color: #333;
      }
      .secondary-button:hover {
        background-color: #e5e5e5;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .danger-button {
        background-color: #e74c3c;
      }
      .danger-button:hover {
        background-color: #c0392b;
      }
      .success-button {
        background-color: #27ae60;
      }
      .success-button:hover {
        background-color: #219a52;
      }
      .approval-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }
      .approval-buttons .button {
        width: auto;
        flex: 1;
        margin: 0;
        padding: 8px 24px;
        font-size: 14px;
        min-width: 80px;
        white-space: nowrap;
      }
      #newApplicationBtn {
        padding: 8px 16px;
        font-size: 14px;
        width: auto;
        min-width: 100px;
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }
      .line-brand {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #999;
      }
      .status-message {
        margin-top: 15px;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        display: none;
      }
      .status-message.success {
        background-color: #d4edda;
        color: #155724;
        display: block;
      }
      .status-message.error {
        background-color: #f8d7da;
        color: #721c24;
        display: block;
      }
      .status-message.info {
        background-color: #e7f3fe;
        color: #004085;
        display: block;
      }
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #06c755;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .hidden {
        display: none !important;
      }

      /* ç‹€æ…‹åˆ†å€å¡Š */
      .tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-bottom: 20px;
      }
      .tab {
        padding: 10px 16px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        transition: all 0.3s;
        font-size: 16px;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .tab:hover {
        background-color: #f9f9f9;
      }
      .tab.active {
        border-bottom-color: #06c755;
        color: #06c755;
        background-color: #f0fdf4;
        font-weight: 600;
      }

      /* æ ¸å‡†æ¬Šé™ç›¸é—œ tab çš„ç‰¹æ®Šæ¨£å¼ */
      .approval-tab {
        background-color: #fef7f0;
        border: 1px solid #f4a261;
        border-bottom: 3px solid transparent;
        margin-left: 4px;
        border-radius: 6px 6px 0 0;
      }

      .approval-tab:hover {
        background-color: #fef3e7;
      }

      .approval-tab.active {
        border-bottom-color: #f4a261;
        color: #e76f51;
        background-color: #fef3e7;
        font-weight: 600;
      }

      /* tab åˆ†éš”ç·š */
      .tab-divider {
        width: 2px;
        background-color: #ddd;
        margin: 8px 12px;
        flex-shrink: 0;
      }

      /* ç”³è«‹åˆ—è¡¨ */
      .search-bar {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: flex-end;
      }
      .search-bar .form-group {
        flex: 1;
        min-width: 150px;
        margin-bottom: 0;
      }
      .search-bar button {
        padding: 12px 20px;
        height: 48px;
      }

      .records-list {
        margin-top: 20px;
      }
      .record-item {
        background-color: #f9f9f9;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s;
      }
      .record-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .record-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        flex-wrap: wrap;
        align-items: flex-start;
      }
      .record-title {
        font-weight: 600;
        color: #333;
        font-size: 18px; /* å¢å¤§å­—å‹ */
        flex: 1;
        min-width: 0;
        line-height: 1.3;
      }
      .record-date {
        color: #777;
        font-size: 12px;
        white-space: nowrap;
        margin-left: 8px;
        flex-shrink: 0;
      }
      .record-details {
        margin-bottom: 10px;
        font-size: 16px; /* å¢å¤§å­—å‹ */
        line-height: 1.4;
      }
      .record-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }
      .record-status {
        display: inline-block;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        margin-left: 8px;
        white-space: nowrap;
      }
      .status-pending {
        background-color: #ffeeba;
        color: #856404;
      }
      .status-approved {
        background-color: #d4edda;
        color: #155724;
      }
      .status-rejected {
        background-color: #f8d7da;
        color: #721c24;
      }

      /* å°è©±æ¡† */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .modal {
        background-color: white;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }
      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: #06c755;
      }
      .modal-close {
        cursor: pointer;
        font-size: 24px;
        color: #aaa;
        border: none;
        background: transparent;
      }
      .modal-close:hover {
        color: #333;
      }
      .modal-form {
        margin-bottom: 20px;
      }
      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      /* åˆ†é¡é¸æ“‡å€ */
      .category-tabs {
        display: flex;
        flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
        gap: 10px; /* æ¨™ç±¤ä¹‹é–“çš„é–“è· */
        margin-top: 5px;
        position: sticky;
        top: 0;
        background: white;
        z-index: 10;
        padding-top: 5px;
        padding-bottom: 10px;
      }
      .category-tab {
        padding: 8px 15px;
        background-color: #f1f1f1;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        border: 1px solid transparent; /* æ·»åŠ é‚Šæ¡†ç”¨æ–¼é¸ä¸­æ™‚å¼·èª¿ */
      }
      .category-tab:hover {
        background-color: #e5e5e5;
      }
      .category-tab.active {
        background-color: #06c755; /* ä½¿ç”¨ LINE ç¶ è‰² */
        color: white;
        box-shadow: 0 2px 4px rgba(6, 199, 85, 0.3); /* æ·»åŠ é™°å½± */
        transform: translateY(-2px); /* è¼•å¾®ä¸Šæµ®æ•ˆæœ */
        border-color: #04a73e; /* æ›´æ·±è‰²çš„é‚Šæ¡† */
      }

      /* ä½¿ç”¨è€…è³‡è¨Šå€ */
      .user-info {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        line-height: 1.6;
      }

      /* åˆ‡æ›åŠŸèƒ½å€ */
      .action-buttons {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      /* é©æ‡‰è¡Œå‹•è£ç½® */
      @media (max-width: 768px) {
        .container {
          margin: 15px;
          padding: 15px;
        }
        .button-group,
        .search-bar {
          flex-direction: column;
        }
        /* ä¿®æ­£æ—¥æœŸé¸æ“‡å™¨ï¼šå›åˆ°ä¸Šä¸‹æ’åˆ— */
        .date-range-container {
          flex-direction: column;
          gap: 15px;
        }
        .date-range-container .form-group {
          flex: 1;
          min-width: 100%;
        }
        .date-separator {
          display: none; /* éš±è—åˆ†éš”ç¬¦ */
        }
        .record-header {
          flex-direction: column;
          gap: 5px;
          align-items: flex-start;
        }
        .record-title {
          font-size: 17px; /* æ‰‹æ©Ÿç‰ˆç¨å¾®ç¸®å°ä½†ä»æ¯”åŸä¾†å¤§ */
          margin-bottom: 3px;
        }
        .record-date {
          font-size: 11px;
          margin-left: 0;
          margin-top: 2px;
        }
        .record-details {
          font-size: 15px; /* æ‰‹æ©Ÿç‰ˆç¨å¾®ç¸®å°ä½†ä»æ¯”åŸä¾†å¤§ */
        }
        .record-actions {
          margin-top: 10px;
          justify-content: flex-start;
        }
        /* å¿«é€Ÿä¿®æ”¹æŒ‰éˆ•æ‰‹æ©Ÿç‰ˆæ¨£å¼ */
        .quick-edit-buttons {
          gap: 6px;
          margin-top: 8px;
        }
        .quick-edit-btn {
          padding: 4px 8px;
          font-size: 11px;
          border-radius: 12px;
        }
        .fromback-option {
          padding: 8px 12px;
          font-size: 13px;
          border-radius: 15px;
        }
        .user-info {
          font-size: 14px;
        }
        .category-tabs {
          overflow-x: auto;
          padding-bottom: 5px;
          flex-wrap: nowrap;
        }
        .tabs {
          overflow-x: auto;
          padding-bottom: 5px;
          flex-wrap: nowrap;
        }
        .tab {
          padding: 6px 10px;
          font-size: 13px;
        }
        .record-status {
          font-size: 11px;
          padding: 2px 5px;
        }
        .batch-controls {
          flex-direction: column;
          gap: 8px;
          align-items: flex-start;
        }
      }

      /* é©æ‡‰æ›´å°çš„è¢å¹• */
      @media (max-width: 480px) {
        .tab {
          padding: 6px 10px;
          font-size: 14px;
        }
        .approval-tab {
          margin-left: 2px;
          padding: 6px 8px;
        }
        .tab-divider {
          margin: 6px 8px;
        }
        .search-bar .form-group {
          min-width: 100%;
        }
        .search-bar .form-group label {
          font-size: 14px;
        }
        .search-bar .form-group input {
          padding: 10px;
          font-size: 14px;
        }
        .record-title {
          font-size: 16px; /* å°è¢å¹•ç‰ˆæœ¬ä¹Ÿå¢å¤§å­—å‹ */
        }
        .record-date {
          font-size: 10px;
        }
        .record-details {
          font-size: 14px; /* å°è¢å¹•ç‰ˆæœ¬ä¹Ÿå¢å¤§å­—å‹ */
        }
        .record-status {
          font-size: 10px;
          padding: 1px 4px;
        }
        h2 {
          font-size: 20px;
        }
        .container {
          margin: 10px;
          padding: 12px;
        }
        .batch-controls {
          flex-direction: column;
          gap: 6px;
          align-items: flex-start;
        }
        .fromback-options {
          flex-direction: row;
          gap: 8px;
          align-items: center;
          justify-content: flex-start;
        }
        .fromback-option {
          padding: 6px 12px;
          font-size: 12px;
          white-space: nowrap;
          flex: 0 0 auto;
        }
      }

      /* æ—¥æœŸé¸æ“‡å™¨æ¨£å¼è¦†è“‹ */
      .flatpickr-day.selected,
      .flatpickr-day.startRange,
      .flatpickr-day.endRange {
        background: #06c755;
        border-color: #06c755;
      }

      /* ç©ºåˆ—è¡¨æç¤º */
      .empty-list {
        text-align: center;
        padding: 30px;
        color: #999;
        font-style: italic;
      }

      /* å…¬å‡ºé¡å‹é†’ç›®é¡¯ç¤ºæ¨£å¼ */
      .fromback-highlight {
        color: #e76f51 !important;
        font-weight: 600 !important;
        background-color: #fef3e7 !important;
        padding: 3px 8px !important;
        border-radius: 6px !important;
        font-size: 14px !important;
        display: inline-block !important;
        margin-top: 4px !important;
        border: 1px solid #f4a261 !important;
        box-shadow: 0 1px 3px rgba(244, 162, 97, 0.2) !important;
      }

      .fromback-highlight::before {
        content: "ğŸš— ";
        margin-right: 4px;
      }

      /* å¤šé¸æ ¸å‡†åŠŸèƒ½ */
      .batch-operations {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
      }
      .batch-operations.show {
        display: block;
      }
      .batch-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 15px;
      }
      .batch-controls .button {
        padding: 8px 16px;
        font-size: 14px;
        margin: 0;
      }
      .fromback-options {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-start;
        width: 100%;
      }
      .record-checkbox {
        margin-right: 10px;
        transform: scale(1.2);
      }
      .record-item.with-checkbox {
        display: flex;
        align-items: flex-start;
        gap: 10px;
      }
      .record-content {
        flex: 1;
      }

      /* ç”³è«‹è¡¨å–®æ™‚é–“é¸é … */
      .time-ranges {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .time-range-option {
        border: 1px solid #ddd;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .time-range-option:hover {
        border-color: #06c755;
      }
      .time-range-option.selected {
        background-color: #06c755;
        color: white;
        border-color: #06c755;
      }
      /* æ—¥æœŸå’Œæ™‚é–“æ”¾åœ¨åŒä¸€è¡Œçš„æ¨£å¼ */
      .date-time-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
      }
      .date-time-group .form-group {
        flex: 1;
        margin-bottom: 0;
      }
      /* åœ¨å°å±å¹•ä¸Šè‡ªå‹•å †ç–Š */
      @media (max-width: 576px) {
        .date-time-group {
          gap: 8px;
        }

        .date-time-group .form-group {
          margin-bottom: 10px;
        }
      }
      /* æ–°å¢: è®“æ—¥æœŸå’Œæ™‚é–“è¼¸å…¥æ¡†æ›´å°ä¸€é» */
      .date-time-group input,
      .date-time-group select {
        padding: 10px 8px;
        font-size: 14px;
      }

      /* æ–°å¢: èª¿æ•´æ¨™ç±¤å­—é«”å¤§å° */
      .date-time-group label {
        font-size: 14px;
      }
      /* æ–°å¢ï¼šé¸å–®ç½®ä¸­ç›¸é—œæ¨£å¼ */
      .modal {
        /* ç¢ºä¿ modal åœ¨æ‰‹æ©Ÿä¸Šä¹Ÿèƒ½å±…ä¸­ */
        display: flex;
        flex-direction: column;
        max-height: 85vh; /* ç¨å¾®ç¸®å°é«˜åº¦ï¼Œé¿å…ä½”æ»¿è¢å¹• */
      }

      .modal-body {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* iOS æµæš¢æ»¾å‹• */
      }

      /* æ–°å¢ï¼šç•¶é¸å–®åœ¨é è¿‘åº•éƒ¨é–‹å•Ÿæ™‚ï¼Œè‡ªå‹•å‘ä¸Šæ»¾å‹•åˆ°è¦–çª—ä¸­é–“ */
      .modal-overlay {
        align-items: center; /* å‚ç›´ç½®ä¸­ */
      }
      .search-bar {
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .search-bar button {
        align-self: flex-end;
        width: auto;
        padding: 12px 30px;
      }

      /* æ—¥æœŸç¯„åœå®¹å™¨æ¨£å¼ */
      .date-range-container {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
      }

      .date-range-container .form-group {
        flex: 1;
      }

      .date-separator {
        margin-top: 25px;
        font-weight: 500;
      }
      /* æ–°å¢ï¼šç”³è«‹é¡åˆ¥å€å¡Šæ¨£å¼ */
      .category-section {
        margin-bottom: 15px;
      }
      /* æ–°å¢ï¼šç¢ºä¿ä¸‹æ‹‰é¸å–®æ‰“é–‹æ™‚å¯ä»¥å®Œæ•´é¡¯ç¤º */
      select {
        position: relative;
        z-index: 5;
      }
      /* æ–°å¢ï¼šå…¨åŸŸéŒ¯èª¤æµ®å‹•æç¤ºæ¨£å¼ */
      .global-error-tooltip {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #e74c3c;
        color: white;
        padding: 12px 18px;
        border-radius: 4px;
        font-size: 15px;
        z-index: 1000;
        max-width: 80%;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        animation: fadeInOut 3s forwards;
        text-align: center;
      }

      /* æ–°å¢ï¼šå‹•ç•«æ•ˆæœ */
      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translate(-50%, -20px);
        }
        10% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
        90% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -20px);
        }
      }

      /* å¿«é€Ÿä¿®æ”¹æŒ‰éˆ•æ¨£å¼ */
      .quick-edit-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .quick-edit-btn {
        padding: 8px 16px; /* å¢å¤§ padding */
        border-radius: 18px; /* å¢å¤§åœ“è§’ */
        border: 1px solid #ddd;
        background-color: #f8f9fa;
        color: #495057;
        font-size: 14px; /* å¢å¤§å­—é«” */
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        font-weight: 500; /* å¢åŠ å­—é‡ */
      }

      .quick-edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºæŒ‰éˆ• - ç°è‰²ç³» */
      .quick-edit-btn.general {
        border-color: #6c757d;
        color: #6c757d;
      }

      .quick-edit-btn.general:hover {
        background-color: #6c757d;
        color: white;
      }

      .quick-edit-btn.general.active {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      /* é€•å¾€æŒ‰éˆ• - è—è‰²ç³» */
      .quick-edit-btn.go {
        border-color: #007bff;
        color: #007bff;
      }

      .quick-edit-btn.go:hover {
        background-color: #007bff;
        color: white;
      }

      .quick-edit-btn.go.active {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      /* é€•è¿”æŒ‰éˆ• - æ©˜è‰²ç³» */
      .quick-edit-btn.back {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .quick-edit-btn.back:hover {
        background-color: #fd7e14;
        color: white;
      }

      .quick-edit-btn.back.active {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      /* ç¢ºä¿å…¬å‡ºé¡å‹é¸é …æ©«å‘æ’åˆ— */
      .fromback-option {
        flex: 0 0 auto;
        min-width: 70px;
        white-space: nowrap;
      }

      /* æ–°å¢ç”³è«‹è¡¨å–®çš„ FromBack é¸é …æ¨£å¼å„ªåŒ– */
      .fromback-option {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 20px;
        background-color: #f8f9fa;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 14px;
        font-weight: 500;
      }

      .fromback-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºé¸é … - ç°è‰²ç³» */
      .fromback-option[data-value=""] {
        border-color: #6c757d;
        color: #6c757d;
      }

      .fromback-option[data-value=""]:hover {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      .fromback-option[data-value=""].selected {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      /* é€•å¾€é¸é … - è—è‰²ç³» */
      .fromback-option[data-value="é€•å¾€"] {
        border-color: #007bff;
        color: #007bff;
      }

      .fromback-option[data-value="é€•å¾€"]:hover {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      .fromback-option[data-value="é€•å¾€"].selected {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
      }

      /* é€•è¿”é¸é … - æ©˜è‰²ç³» */
      .fromback-option[data-value="é€•è¿”"] {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .fromback-option[data-value="é€•è¿”"]:hover {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      .fromback-option[data-value="é€•è¿”"].selected {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
        box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
      }

      /* æ–°å¢ï¼šå¿«é€Ÿä¿®æ”¹æŒ‰éˆ•å’Œå…¬å‡ºé¡å‹é¸é …æ¨£å¼èª¿æ•´ */
      .quick-edit-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .quick-edit-btn {
        padding: 6px 12px;
        border-radius: 15px;
        border: 1px solid #ddd;
        background-color: #f8f9fa;
        color: #495057;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .quick-edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºæŒ‰éˆ• - ç°è‰²ç³» */
      .quick-edit-btn.general {
        border-color: #6c757d;
        color: #6c757d;
      }

      .quick-edit-btn.general:hover {
        background-color: #6c757d;
        color: white;
      }

      .quick-edit-btn.general.active {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      /* é€•å¾€æŒ‰éˆ• - è—è‰²ç³» */
      .quick-edit-btn.go {
        border-color: #007bff;
        color: #007bff;
      }

      .quick-edit-btn.go:hover {
        background-color: #007bff;
        color: white;
      }

      .quick-edit-btn.go.active {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      /* é€•è¿”æŒ‰éˆ• - æ©˜è‰²ç³» */
      .quick-edit-btn.back {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .quick-edit-btn.back:hover {
        background-color: #fd7e14;
        color: white;
      }

      .quick-edit-btn.back.active {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      /* æ–°å¢ç”³è«‹è¡¨å–®çš„ FromBack é¸é …æ¨£å¼å„ªåŒ– */
      .fromback-option {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 20px;
        background-color: #f8f9fa;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 14px;
        font-weight: 500;
      }

      .fromback-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºé¸é … - ç°è‰²ç³» */
      .fromback-option[data-value=""] {
        border-color: #6c757d;
        color: #6c757d;
      }

      .fromback-option[data-value=""]:hover {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      .fromback-option[data-value=""].selected {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      /* é€•å¾€é¸é … - è—è‰²ç³» */
      .fromback-option[data-value="é€•å¾€"] {
        border-color: #007bff;
        color: #007bff;
      }

      .fromback-option[data-value="é€•å¾€"]:hover {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      .fromback-option[data-value="é€•å¾€"].selected {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
      }

      /* é€•è¿”é¸é … - æ©˜è‰²ç³» */
      .fromback-option[data-value="é€•è¿”"] {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .fromback-option[data-value="é€•è¿”"]:hover {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      .fromback-option[data-value="é€•è¿”"].selected {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
        box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
      }

      /* æ–°å¢ï¼šå¿«é€Ÿä¿®æ”¹æŒ‰éˆ•å’Œå…¬å‡ºé¡å‹é¸é …æ¨£å¼èª¿æ•´ */
      .quick-edit-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .quick-edit-btn {
        padding: 6px 12px;
        border-radius: 15px;
        border: 1px solid #ddd;
        background-color: #f8f9fa;
        color: #495057;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .quick-edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºæŒ‰éˆ• - ç°è‰²ç³» */
      .quick-edit-btn.general {
        border-color: #6c757d;
        color: #6c757d;
      }

      .quick-edit-btn.general:hover {
        background-color: #6c757d;
        color: white;
      }

      .quick-edit-btn.general.active {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      /* é€•å¾€æŒ‰éˆ• - è—è‰²ç³» */
      .quick-edit-btn.go {
        border-color: #007bff;
        color: #007bff;
      }

      .quick-edit-btn.go:hover {
        background-color: #007bff;
        color: white;
      }

      .quick-edit-btn.go.active {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      /* é€•è¿”æŒ‰éˆ• - æ©˜è‰²ç³» */
      .quick-edit-btn.back {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .quick-edit-btn.back:hover {
        background-color: #fd7e14;
        color: white;
      }

      .quick-edit-btn.back.active {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      /* æ–°å¢ç”³è«‹è¡¨å–®çš„ FromBack é¸é …æ¨£å¼å„ªåŒ– */
      .fromback-option {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 20px;
        background-color: #f8f9fa;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 14px;
        font-weight: 500;
      }

      .fromback-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºé¸é … - ç°è‰²ç³» */
      .fromback-option[data-value=""] {
        border-color: #6c757d;
        color: #6c757d;
      }

      .fromback-option[data-value=""]:hover {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      .fromback-option[data-value=""].selected {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      /* é€•å¾€é¸é … - è—è‰²ç³» */
      .fromback-option[data-value="é€•å¾€"] {
        border-color: #007bff;
        color: #007bff;
      }

      .fromback-option[data-value="é€•å¾€"]:hover {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      .fromback-option[data-value="é€•å¾€"].selected {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
      }

      /* é€•è¿”é¸é … - æ©˜è‰²ç³» */
      .fromback-option[data-value="é€•è¿”"] {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .fromback-option[data-value="é€•è¿”"]:hover {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      .fromback-option[data-value="é€•è¿”"].selected {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
        box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
      }

      /* æ–°å¢ï¼šå¿«é€Ÿä¿®æ”¹æŒ‰éˆ•å’Œå…¬å‡ºé¡å‹é¸é …æ¨£å¼èª¿æ•´ */
      .quick-edit-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .quick-edit-btn {
        padding: 6px 12px;
        border-radius: 15px;
        border: 1px solid #ddd;
        background-color: #f8f9fa;
        color: #495057;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .quick-edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºæŒ‰éˆ• - ç°è‰²ç³» */
      .quick-edit-btn.general {
        border-color: #6c757d;
        color: #6c757d;
      }

      .quick-edit-btn.general:hover {
        background-color: #6c757d;
        color: white;
      }

      .quick-edit-btn.general.active {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      /* é€•å¾€æŒ‰éˆ• - è—è‰²ç³» */
      .quick-edit-btn.go {
        border-color: #007bff;
        color: #007bff;
      }

      .quick-edit-btn.go:hover {
        background-color: #007bff;
        color: white;
      }

      .quick-edit-btn.go.active {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      /* é€•è¿”æŒ‰éˆ• - æ©˜è‰²ç³» */
      .quick-edit-btn.back {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .quick-edit-btn.back:hover {
        background-color: #fd7e14;
        color: white;
      }

      .quick-edit-btn.back.active {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      /* æ–°å¢ç”³è«‹è¡¨å–®çš„ FromBack é¸é …æ¨£å¼å„ªåŒ– */
      .fromback-option {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 20px;
        background-color: #f8f9fa;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 14px;
        font-weight: 500;
      }

      .fromback-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºé¸é … - ç°è‰²ç³» */
      .fromback-option[data-value=""] {
        border-color: #6c757d;
        color: #6c757d;
      }

      .fromback-option[data-value=""]:hover {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      .fromback-option[data-value=""].selected {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      /* é€•å¾€é¸é … - è—è‰²ç³» */
      .fromback-option[data-value="é€•å¾€"] {
        border-color: #007bff;
        color: #007bff;
      }

      .fromback-option[data-value="é€•å¾€"]:hover {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      .fromback-option[data-value="é€•å¾€"].selected {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
      }

      /* é€•è¿”é¸é … - æ©˜è‰²ç³» */
      .fromback-option[data-value="é€•è¿”"] {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .fromback-option[data-value="é€•è¿”"]:hover {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      .fromback-option[data-value="é€•è¿”"].selected {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
        box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
      }

      /* æ–°å¢ï¼šå¿«é€Ÿä¿®æ”¹æŒ‰éˆ•å’Œå…¬å‡ºé¡å‹é¸é …æ¨£å¼èª¿æ•´ */
      .quick-edit-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .quick-edit-btn {
        padding: 6px 12px;
        border-radius: 15px;
        border: 1px solid #ddd;
        background-color: #f8f9fa;
        color: #495057;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .quick-edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºæŒ‰éˆ• - ç°è‰²ç³» */
      .quick-edit-btn.general {
        border-color: #6c757d;
        color: #6c757d;
      }

      .quick-edit-btn.general:hover {
        background-color: #6c757d;
        color: white;
      }

      .quick-edit-btn.general.active {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      /* é€•å¾€æŒ‰éˆ• - è—è‰²ç³» */
      .quick-edit-btn.go {
        border-color: #007bff;
        color: #007bff;
      }

      .quick-edit-btn.go:hover {
        background-color: #007bff;
        color: white;
      }

      .quick-edit-btn.go.active {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      /* é€•è¿”æŒ‰éˆ• - æ©˜è‰²ç³» */
      .quick-edit-btn.back {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .quick-edit-btn.back:hover {
        background-color: #fd7e14;
        color: white;
      }

      .quick-edit-btn.back.active {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      /* æ–°å¢ç”³è«‹è¡¨å–®çš„ FromBack é¸é …æ¨£å¼å„ªåŒ– */
      .fromback-option {
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 20px;
        background-color: #f8f9fa;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 14px;
        font-weight: 500;
      }

      .fromback-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* ä¸€èˆ¬å…¬å‡ºé¸é … - ç°è‰²ç³» */
      .fromback-option[data-value=""] {
        border-color: #6c757d;
        color: #6c757d;
      }

      .fromback-option[data-value=""]:hover {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
      }

      .fromback-option[data-value=""].selected {
        background-color: #6c757d;
        color: white;
        border-color: #5a6268;
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      /* é€•å¾€é¸é … - è—è‰²ç³» */
      .fromback-option[data-value="é€•å¾€"] {
        border-color: #007bff;
        color: #007bff;
      }

      .fromback-option[data-value="é€•å¾€"]:hover {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
      }

      .fromback-option[data-value="é€•å¾€"].selected {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
      }

      /* é€•è¿”é¸é … - æ©˜è‰²ç³» */
      .fromback-option[data-value="é€•è¿”"] {
        border-color: #fd7e14;
        color: #fd7e14;
      }

      .fromback-option[data-value="é€•è¿”"]:hover {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
      }

      .fromback-option[data-value="é€•è¿”"].selected {
        background-color: #fd7e14;
        color: white;
        border-color: #e55a00;
        box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
      }

      /* æ–°å¢ï¼šå¿«é€Ÿä¿®æ”¹æŒ‰éˆ•å’Œå…¬å‡ºé¡å‹é¸é …æ¨£å¼èª¿æ•´ */
      .quick-edit-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .quick-edit-btn {
        padding: 6px 12px;
        border-radius: 15px;
        border: 1px solid #ddd;
        background-color: #f8f9fa;
        color: #495057;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .quick-edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* å¿«é€Ÿä¿®æ”¹æŒ‰éˆ•æ‰‹æ©Ÿç‰ˆæ¨£å¼ */
      @media (max-width: 576px) {
        .quick-edit-buttons {
          gap: 6px;
          margin-top: 8px;
        }

        .quick-edit-btn {
          padding: 6px 12px; /* æ‰‹æ©Ÿç‰ˆä¹Ÿå¢å¤§ä¸€äº› */
          font-size: 12px; /* æ‰‹æ©Ÿç‰ˆå­—é«”ä¹Ÿç¨å¾®å¢å¤§ */
          border-radius: 15px; /* å¢å¤§åœ“è§’ */
          font-weight: 500; /* å¢åŠ å­—é‡ */
        }

        .fromback-option {
          padding: 8px 12px;
          font-size: 13px;
          border-radius: 15px;
        }
      }

      /* é€•å¾€åŠé€•è¿”é¸é … - ç´«è‰²ç³» */
      .fromback-option[data-value="é€•å¾€åŠé€•è¿”"] {
        border-color: #6f42c1;
        color: #6f42c1;
      }

      .fromback-option[data-value="é€•å¾€åŠé€•è¿”"]:hover {
        background-color: #6f42c1;
        color: white;
        border-color: #5a3399;
      }

      .fromback-option[data-value="é€•å¾€åŠé€•è¿”"].selected {
        background-color: #6f42c1;
        color: white;
        border-color: #5a3399;
        box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
      }

      /* é€•å¾€åŠé€•è¿”å¿«é€Ÿç·¨è¼¯æŒ‰éˆ• - ç´«è‰²ç³» */
      .quick-edit-btn.both {
        border-color: #6f42c1;
        color: #6f42c1;
      }

      .quick-edit-btn.both:hover {
        background-color: #6f42c1;
        color: white;
      }

      .quick-edit-btn.both.active {
        background-color: #6f42c1;
        color: white;
        border-color: #5a3399;
      }

      /* ç¢ºä¿å¿«é€Ÿç·¨è¼¯æŒ‰éˆ•åœ¨åŒä¸€åˆ—é¡¯ç¤º */
      .quick-edit-buttons {
        flex-wrap: nowrap !important;
        gap: 6px !important;
        overflow-x: auto;
      }

      .quick-edit-btn {
        padding: 8px 16px !important; /* å¢å¤§ */
        font-size: 14px !important; /* å¢å¤§å­—é«” */
        min-width: 60px; /* å¢åŠ æœ€å°å¯¬åº¦ */
        border-radius: 18px !important; /* å¢å¤§åœ“è§’ */
        font-weight: 500 !important; /* å¢åŠ å­—é‡ */
      }

      /* æ‰‹æ©Ÿç‰ˆæœ¬é©é… */
      @media (max-width: 576px) {
        .quick-edit-btn {
          padding: 6px 12px !important; /* æ‰‹æ©Ÿç‰ˆä¹Ÿå¢å¤§ */
          font-size: 12px !important; /* æ‰‹æ©Ÿç‰ˆå­—é«”å¢å¤§ */
          min-width: 50px; /* æ‰‹æ©Ÿç‰ˆæœ€å°å¯¬åº¦ */
        }
      }
    </style>
  </head>
  <body>
    <!-- æ–°å¢ï¼šå…¨åŸŸæµ®å‹•æç¤ºå®¹å™¨ -->
    <div
      id="globalErrorTooltip"
      class="global-error-tooltip"
      style="display: none"
    ></div>
    <div id="loading-overlay" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <div class="container">
      <h2>ç·šä¸Šç°½æ ¸</h2>
      <div id="statusMessage" class="status-message"></div>

      <!-- ä½¿ç”¨è€…è³‡è¨Šå€ -->
      <div id="userInfo" class="user-info hidden">
        <!-- ä½¿ç”¨è€…è³‡è¨Šæœƒåœ¨JSä¸­è¢«å¡«å…¥ -->
      </div>

      <!-- åŠŸèƒ½æŒ‰éˆ•å€ -->
      <div class="action-buttons">
        <button id="newApplicationBtn" class="button">æ–°å¢ç°½æ ¸</button>
      </div>

      <!-- ç”³è«‹ç‹€æ…‹åˆ†é  -->
      <div class="tabs">
        <div class="tab active" data-status="pending">å·²é€å‡º</div>
        <div class="tab" data-status="pass">å·²æ ¸å‡†</div>
        <div class="tab" data-status="reject">ä¸æ ¸æº–</div>
        <div class="tab-divider"></div>
        <div class="tab approval-tab" data-status="pending-approval">
          å¾…ç°½æ ¸
        </div>
        <div class="tab approval-tab" data-status="my-approved">å·²ç°½æ ¸</div>
      </div>

      <!-- æœå°‹æ¢ä»¶å€ -->
      <div class="search-bar">
        <div class="date-range-container">
          <div class="form-group">
            <label for="startDate">é–‹å§‹æ—¥æœŸ</label>
            <input
              type="text"
              id="startDate"
              class="date-picker"
              placeholder="é¸æ“‡é–‹å§‹æ—¥æœŸ"
            />
          </div>
          <div class="date-separator">è‡³</div>
          <div class="form-group">
            <label for="endDate">é è¨ˆçµæŸ</label>
            <input
              type="text"
              id="endDate"
              class="date-picker"
              placeholder="é¸æ“‡çµæŸæ—¥æœŸ"
            />
          </div>
        </div>
        <button id="searchBtn" class="button">æœå°‹</button>
      </div>

      <!-- ç”³è«‹è¨˜éŒ„åˆ—è¡¨ -->
      <div id="recordsList" class="records-list">
        <div class="empty-list" id="emptyListMessage">ç„¡ç°½æ ¸è¨˜éŒ„</div>
        <!-- è¨˜éŒ„å°‡ç”±JavaScriptå‹•æ…‹å¡«å…¥ -->
      </div>

      <!-- æ–°å¢ç”³è«‹å°è©±æ¡† -->
      <div id="newApplicationModal" class="modal-overlay hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">æ–°å¢ç°½æ ¸äº‹é …</div>
            <button class="modal-close">&times;</button>
          </div>
          <!-- æ–°å¢ç”³è«‹å°è©±æ¡†è¡¨å–®ä¸­çš„æ—¥æœŸå’Œæ™‚é–“èª¿æ•´ -->
          <div class="modal-body">
            <div class="form-group category-section">
              <label>é¡åˆ¥</label>
              <div id="categoryTabs" class="category-tabs">
                <!-- åˆ†é¡æœƒç”±JavaScriptå‹•æ…‹å¡«å…¥ -->
              </div>
            </div>

            <!-- ç”³è«‹è¡¨å–® -->
            <form id="applicationForm" class="modal-form">
              <div class="form-group">
                <label for="eventItem" class="required">é …ç›®</label>
                <select id="eventItem" required>
                  <option value="">è«‹é¸æ“‡ç°½æ ¸é …ç›®</option>
                  <!-- é …ç›®é¸é …æœƒç”±JavaScriptå‹•æ…‹å¡«å…¥ -->
                </select>
                <div class="error-tooltip" id="eventItem-error">
                  è«‹é¸æ“‡ç°½æ ¸é …ç›®
                </div>
              </div>

              <!-- ç”³è«‹æ—¥æœŸå’Œæ™‚é–“ï¼ˆåŒä¸€è¡Œï¼‰ -->
              <div class="date-time-group">
                <div class="form-group">
                  <label for="leaveDate" class="required">é–‹å§‹æ—¥æœŸ</label>
                  <input
                    type="text"
                    id="leaveDate"
                    class="date-picker"
                    required
                    placeholder="é¸æ“‡é–‹å§‹æ—¥æœŸ"
                  />
                  <div class="error-tooltip" id="leaveDate-error">
                    è«‹é¸æ“‡é–‹å§‹æ—¥æœŸ
                  </div>
                </div>
                <div class="form-group">
                  <label for="leaveTime" class="required">é–‹å§‹æ™‚é–“</label>
                  <select id="leaveTime" required>
                    <option value="">é¸æ“‡æ™‚é–“</option>
                    <option value="07:00">07:00</option>
                    <option value="07:30">07:30</option>
                    <option value="08:00">08:00</option>
                    <option value="08:30">08:30</option>
                    <option value="09:00">09:00</option>
                    <option value="09:30">09:30</option>
                    <option value="10:00">10:00</option>
                    <option value="10:30">10:30</option>
                    <option value="11:00">11:00</option>
                    <option value="11:30">11:30</option>
                    <option value="12:00">12:00</option>
                    <option value="12:30">12:30</option>
                    <option value="13:00">13:00</option>
                    <option value="13:30">13:30</option>
                    <option value="14:00">14:00</option>
                    <option value="14:30">14:30</option>
                    <option value="15:00">15:00</option>
                    <option value="15:30">15:30</option>
                    <option value="16:00">16:00</option>
                    <option value="16:30">16:30</option>
                    <option value="17:00">17:00</option>
                    <option value="17:30">17:30</option>
                    <option value="18:00">18:00</option>
                    <option value="18:30">18:30</option>
                    <option value="19:00">19:00</option>
                    <option value="19:30">19:30</option>
                    <option value="20:00">20:00</option>
                    <option value="20:30">20:30</option>
                    <option value="21:00">21:00</option>
                    <option value="21:30">21:30</option>
                    <option value="22:00">22:00</option>
                    <option value="22:30">22:30</option>
                    <option value="23:00">23:00</option>
                    <option value="23:30">23:30</option>
                  </select>
                  <div class="error-tooltip" id="leaveTime-error">
                    è«‹é¸æ“‡é–‹å§‹æ™‚é–“
                  </div>
                </div>
              </div>

              <!-- çµæŸæ—¥æœŸå’Œæ™‚é–“ï¼ˆåŒä¸€è¡Œï¼‰ -->
              <div class="date-time-group">
                <div class="form-group">
                  <label for="backDate" class="required">çµæŸæ—¥æœŸ</label>
                  <input
                    type="text"
                    id="backDate"
                    class="date-picker"
                    placeholder="é¸æ“‡çµæŸæ—¥æœŸ"
                  />
                  <div class="error-tooltip" id="backDate-error">
                    çµæŸæ—¥æœŸå¿…é ˆåœ¨é–‹å§‹æ—¥æœŸä¹‹å¾Œ
                  </div>
                </div>
                <div class="form-group">
                  <label for="backTime" class="required">çµæŸæ™‚é–“</label>
                  <select id="backTime">
                    <option value="">é¸æ“‡æ™‚é–“</option>
                    <option value="07:00">07:00</option>
                    <option value="07:30">07:30</option>
                    <option value="08:00">08:00</option>
                    <option value="08:30">08:30</option>
                    <option value="09:00">09:00</option>
                    <option value="09:30">09:30</option>
                    <option value="10:00">10:00</option>
                    <option value="10:30">10:30</option>
                    <option value="11:00">11:00</option>
                    <option value="11:30">11:30</option>
                    <option value="12:00">12:00</option>
                    <option value="12:30">12:30</option>
                    <option value="13:00">13:00</option>
                    <option value="13:30">13:30</option>
                    <option value="14:00">14:00</option>
                    <option value="14:30">14:30</option>
                    <option value="15:00">15:00</option>
                    <option value="15:30">15:30</option>
                    <option value="16:00">16:00</option>
                    <option value="16:30">16:30</option>
                    <option value="17:00">17:00</option>
                    <option value="17:30">17:30</option>
                    <option value="18:00">18:00</option>
                    <option value="18:30">18:30</option>
                    <option value="19:00">19:00</option>
                    <option value="19:30">19:30</option>
                    <option value="20:00">20:00</option>
                    <option value="20:30">20:30</option>
                    <option value="21:00">21:00</option>
                    <option value="21:30">21:30</option>
                    <option value="22:00">22:00</option>
                    <option value="22:30">22:30</option>
                    <option value="23:00">23:00</option>
                    <option value="23:30">23:30</option>
                  </select>
                  <div class="error-tooltip" id="backTime-error">
                    è«‹é¸æ“‡çµæŸæ™‚é–“
                  </div>
                </div>
              </div>

              <!-- å…¶é¤˜è¡¨å–®é …ç›®ä¿æŒä¸è®Š -->
              <div class="form-group" id="locationGroup">
                <label for="location">åœ°é»</label>
                <input type="text" id="location" placeholder="è«‹è¼¸å…¥åœ°é»" />
              </div>

              <div class="form-group">
                <label for="approverType" class="required">ç°½æ ¸ç¯„åœ</label>
                <select id="approverType" required>
                  <option value="same-dept">æœ¬éƒ¨é–€</option>
                  <option value="other-dept">å…¶å®ƒéƒ¨é–€</option>
                  <option value="other-company">å…¶å®ƒå…¬å¸åˆ¥(æœ‰å…¼ä»»ä¸»ç®¡)</option>
                </select>
                <div class="error-tooltip" id="approverType-error">
                  è«‹é¸æ“‡ç°½æ ¸ç¯„åœ
                </div>
              </div>

              <div
                class="form-group"
                id="otherCompanyGroup"
                style="display: none"
              >
                <label for="otherCompany" class="required">é¸æ“‡å…¬å¸</label>
                <select id="otherCompany">
                  <option value="">è«‹é¸æ“‡å…¬å¸</option>
                  <!-- å…¬å¸é¸é …æœƒç”±JavaScriptå‹•æ…‹å¡«å…¥ -->
                </select>
                <div class="error-tooltip" id="otherCompany-error">
                  è«‹é¸æ“‡å…¬å¸
                </div>
              </div>

              <div class="form-group" id="otherDeptGroup" style="display: none">
                <label for="otherDept" class="required">é¸æ“‡éƒ¨é–€</label>
                <select id="otherDept">
                  <option value="">è«‹é¸æ“‡éƒ¨é–€</option>
                  <!-- éƒ¨é–€é¸é …æœƒç”±JavaScriptå‹•æ…‹å¡«å…¥ -->
                </select>
                <div class="error-tooltip" id="otherDept-error">è«‹é¸æ“‡éƒ¨é–€</div>
              </div>

              <div class="form-group">
                <label for="approveUserId" class="required">ç°½æ ¸äººå“¡</label>
                <select id="approveUserId" required>
                  <option value="">è«‹é¸æ“‡ç°½æ ¸äººå“¡</option>
                  <!-- ä¸»ç®¡é¸é …æœƒç”±JavaScriptå‹•æ…‹å¡«å…¥ -->
                </select>
                <div class="error-tooltip" id="approveUserId-error">
                  è«‹é¸æ“‡æ ¸å‡†äººå“¡
                </div>
              </div>

              <div class="form-group">
                <label for="desc" class="required">äº‹ç”±</label>
                <textarea
                  id="desc"
                  placeholder="è«‹è¼¸å…¥äº‹ç”±"
                  required
                ></textarea>
                <div class="error-tooltip" id="desc-error">è«‹è¼¸å…¥äº‹ç”±</div>
              </div>

              <!-- æ–°å¢ï¼šé€•å¾€é€•è¿”è¨­å®š -->
              <div class="form-group">
                <label for="fromBackCmpy">å…¬å‡ºé¡å‹</label>
                <div class="fromback-options">
                  <div class="fromback-option selected" data-value="">ä¸€èˆ¬</div>
                  <div class="fromback-option" data-value="é€•å¾€">é€•å¾€</div>
                  <div class="fromback-option" data-value="é€•è¿”">é€•è¿”</div>
                  <div class="fromback-option" data-value="é€•å¾€åŠé€•è¿”">
                    é€•å¾€åŠé€•è¿”
                  </div>
                </div>
                <input type="hidden" id="fromBackCmpy" value="" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button id="cancelApplicationBtn" class="button secondary-button">
              å–æ¶ˆ
            </button>
            <button id="submitApplicationBtn" class="button">é€å‡ºç°½æ ¸</button>
          </div>
        </div>
      </div>

      <!-- ç¢ºèªå°è©±æ¡† -->
      <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">ç¢ºèªæ“ä½œ</div>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <p id="confirmMessage">æ‚¨ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
          </div>
          <div class="modal-footer">
            <button id="confirmCancelBtn" class="button secondary-button">
              å–æ¶ˆ
            </button>
            <button id="confirmOkBtn" class="button">ç¢ºèª</button>
          </div>
        </div>
      </div>

      <div class="line-brand">å¤šåŠŸèƒ½å¹³å°-ç·šä¸Šç°½æ ¸-v1.0.3.5</div>
    </div>

    <!-- JavaScript -->
    <script>
      // å…¨å±€è®Šæ•¸
      const base_url = "https://35.221.146.143.nip.io/linehook/" // API åŸºç¤ URL
      const channelId = "2006992891" // æœå‹™ ID
      const liffId = "2006993665-xkeLlPeW".trim() // LIFF ID

      // ç”¨æˆ¶è³‡è¨Š
      let currentUser = null
      let eventItems = [] // æ‰€æœ‰ç”³è«‹é …ç›®
      let categories = [] // æ‰€æœ‰åˆ†é¡
      let approvers = [] // å¯é¸çš„æ ¸å‡†ä¸»ç®¡
      let currentStatus = "pending" // ç•¶å‰æª¢è¦–çš„ç”³è«‹ç‹€æ…‹
      let currentCategory = null // ç•¶å‰é¸ä¸­çš„åˆ†é¡
      let confirmCallback = null // ç¢ºèªå°è©±æ¡†çš„å›å‘¼å‡½æ•¸
      // ç§»é™¤æ‰¹é‡æ“ä½œè®Šæ•¸ï¼Œæ”¹ç‚ºå–®ç­†å¿«é€Ÿä¿®æ”¹æ¨¡å¼

      // DOM å…ƒç´ è¼‰å…¥å¾Œåˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", () => {
        // åˆå§‹åŒ–é é¢å…ƒç´ çš„äº‹ä»¶ç›£è½å™¨
        initEventListeners()

        // åˆå§‹åŒ–æ—¥æœŸé¸æ“‡å™¨
        initDatePickers()

        // æª¢æŸ¥ URL åƒæ•¸ä¸¦è¨­ç½®å°æ‡‰çš„ tab
        const urlParams = new URLSearchParams(window.location.search)
        const tabParam = urlParams.get("tab")

        let defaultTab = "pending" // é è¨­ç‚ºå·²é€å‡º

        // å¦‚æœ URL ä¸­æŒ‡å®šäº† tab åƒæ•¸ï¼Œä½¿ç”¨è©²åƒæ•¸
        if (
          tabParam &&
          [
            "pending",
            "pass",
            "reject",
            "pending-approval",
            "my-approved",
          ].includes(tabParam)
        ) {
          defaultTab = tabParam
        }

        // è¨­ç½®é è¨­çš„åˆ†é ç‹€æ…‹
        setActiveTab(defaultTab)

        // åˆå§‹åŒ– LIFF
        initLIFF()
      })

      // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
      function initEventListeners() {
        // åˆ†é åˆ‡æ›
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            const status = tab.dataset.status
            setActiveTab(status)
            loadRecords()
          })
        })

        // æœå°‹æŒ‰éˆ•
        document.getElementById("searchBtn").addEventListener("click", () => {
          loadRecords()
        })

        // æ–°å¢ç”³è«‹æŒ‰éˆ•
        document
          .getElementById("newApplicationBtn")
          .addEventListener("click", () => {
            showNewApplicationModal()
          })

        // é—œé–‰æ–°å¢ç”³è«‹å°è©±æ¡†
        document.querySelectorAll(".modal-close").forEach((closeBtn) => {
          closeBtn.addEventListener("click", (event) => {
            event.target.closest(".modal-overlay").classList.add("hidden")
          })
        })

        // å–æ¶ˆæ–°å¢ç”³è«‹
        document
          .getElementById("cancelApplicationBtn")
          .addEventListener("click", () => {
            document
              .getElementById("newApplicationModal")
              .classList.add("hidden")
          })

        // é€å‡ºç”³è«‹
        document
          .getElementById("submitApplicationBtn")
          .addEventListener("click", () => {
            validateAndSubmitApplication()
          })

        // ç¢ºèªå°è©±æ¡†
        document
          .getElementById("confirmCancelBtn")
          .addEventListener("click", () => {
            document.getElementById("confirmModal").classList.add("hidden")
          })

        document
          .getElementById("confirmOkBtn")
          .addEventListener("click", () => {
            document.getElementById("confirmModal").classList.add("hidden")
            if (typeof confirmCallback === "function") {
              confirmCallback()
              confirmCallback = null
            }
          })

        // æ–°å¢åŠŸèƒ½ï¼šç›£è½é–‹å§‹æ—¥æœŸè®Šæ›´ï¼Œè‡ªå‹•è¨­å®šçµæŸæ—¥æœŸç‚ºåŒä¸€å¤©
        document
          .getElementById("leaveDate")
          .addEventListener("change", function () {
            const startDate = this.value
            if (startDate) {
              document.getElementById("backDate").value = startDate
            }
          })

        // æ–°å¢åŠŸèƒ½ï¼šç›£è½é …ç›®é¸æ“‡è®ŠåŒ–
        document
          .getElementById("eventItem")
          .addEventListener("change", function () {
            const leaveTime = document.getElementById("leaveTime").value

            // å¦‚æœå·²é¸å–é–‹å§‹æ™‚é–“ï¼Œé‡æ–°è¨ˆç®—çµæŸæ™‚é–“
            if (leaveTime) {
              setEndTimePlus4Hours(leaveTime)
            }
          })

        // æ–°å¢åŠŸèƒ½ï¼šç›£è½ç°½æ ¸ç¯„åœè®Šæ›´
        document
          .getElementById("approverType")
          .addEventListener("change", function () {
            const approverType = this.value
            const otherCompanyGroup =
              document.getElementById("otherCompanyGroup")
            const otherDeptGroup = document.getElementById("otherDeptGroup")

            // é‡ç½®æ‰€æœ‰é¸æ“‡
            document.getElementById("otherCompany").selectedIndex = 0
            document.getElementById("otherDept").selectedIndex = 0
            document.getElementById("approveUserId").innerHTML =
              '<option value="">è«‹é¸æ“‡ç°½æ ¸äººå“¡</option>'

            if (approverType === "same-dept") {
              // æœ¬éƒ¨é–€ï¼šéš±è—å…¶ä»–é¸é …ï¼Œç›´æ¥è¼‰å…¥åŒéƒ¨é–€äººå“¡
              otherCompanyGroup.style.display = "none"
              otherDeptGroup.style.display = "none"
              loadPotentialApprovers()
            } else if (approverType === "other-dept") {
              // å…¶ä»–éƒ¨é–€ï¼šé¡¯ç¤ºéƒ¨é–€é¸æ“‡ï¼Œéš±è—å…¬å¸é¸æ“‡
              otherCompanyGroup.style.display = "none"
              otherDeptGroup.style.display = "block"
              loadDepartments() // è¼‰å…¥æœ¬å…¬å¸çš„æ‰€æœ‰éƒ¨é–€
            } else if (approverType === "other-company") {
              // å…¶ä»–å…¬å¸ï¼šé¡¯ç¤ºå…¬å¸å’Œéƒ¨é–€é¸æ“‡
              otherCompanyGroup.style.display = "block"
              otherDeptGroup.style.display = "block"
              loadCompanies()
            }
          })

        // æ–°å¢åŠŸèƒ½ï¼šç›£è½å…¬å¸é¸æ“‡è®Šæ›´
        document
          .getElementById("otherCompany")
          .addEventListener("change", function () {
            const selectedCompany = this.value
            if (selectedCompany) {
              loadDepartments(selectedCompany)
            } else {
              document.getElementById("otherDept").innerHTML =
                '<option value="">è«‹é¸æ“‡éƒ¨é–€</option>'
            }
            // é‡ç½®ç°½æ ¸äººå“¡é¸æ“‡
            document.getElementById("approveUserId").innerHTML =
              '<option value="">è«‹é¸æ“‡ç°½æ ¸äººå“¡</option>'
          })

        // æ–°å¢åŠŸèƒ½ï¼šç›£è½éƒ¨é–€é¸æ“‡è®Šæ›´
        document
          .getElementById("otherDept")
          .addEventListener("change", function () {
            const selectedDept = this.value
            if (selectedDept) {
              loadPotentialApprovers()
            } else {
              document.getElementById("approveUserId").innerHTML =
                '<option value="">è«‹é¸æ“‡ç°½æ ¸äººå“¡</option>'
            }
          })

        // æ–°å¢åŠŸèƒ½ï¼šç›£è½é–‹å§‹æ™‚é–“è®Šæ›´ï¼Œè‡ªå‹•è¨­å®šçµæŸæ™‚é–“+4å°æ™‚
        document
          .getElementById("leaveTime")
          .addEventListener("change", function () {
            const leaveTime = this.value

            if (!leaveTime) return

            // çµæŸæ™‚é–“ç‚ºé–‹å§‹æ™‚é–“+4å°æ™‚
            setEndTimePlus4Hours(leaveTime)
          })

        // ç§»é™¤æ‰¹é‡æ“ä½œç›¸é—œäº‹ä»¶ï¼ˆå·²ä¸å†éœ€è¦ï¼‰

        // æ–°å¢ç”³è«‹è¡¨å–®çš„ FromBack é¸é …é¸æ“‡
        document
          .querySelectorAll("#applicationForm .fromback-option")
          .forEach((option) => {
            option.addEventListener("click", () => {
              // æ›´æ–°é¸ä¸­ç‹€æ…‹
              document
                .querySelectorAll("#applicationForm .fromback-option")
                .forEach((opt) => {
                  opt.classList.remove("selected")
                })
              option.classList.add("selected")

              // æ›´æ–°éš±è—çš„ input å€¼
              document.getElementById("fromBackCmpy").value =
                option.dataset.value
            })
          })
      }
      // æ–°å¢å‡½æ•¸ï¼šè¨­å®šçµæŸæ™‚é–“ç‚ºé–‹å§‹æ™‚é–“+4å°æ™‚
      function setEndTimePlus4Hours(startTimeStr) {
        if (!startTimeStr) return

        // è§£æé–‹å§‹æ™‚é–“
        const [startHour, startMinute] = startTimeStr.split(":").map(Number)

        // è¨ˆç®—çµæŸæ™‚é–“ (åŠ 4å°æ™‚)
        let endHour = startHour + 4

        // å¦‚æœè¶…é23é»ï¼Œè¨­ç‚º23é»
        if (endHour > 23) {
          endHour = 23
        }

        // æ ¼å¼åŒ–çµæŸæ™‚é–“
        const endTimeStr = `${endHour.toString().padStart(2, "0")}:${startMinute
          .toString()
          .padStart(2, "0")}`

        // åœ¨ä¸‹æ‹‰é¸å–®ä¸­æ‰¾åˆ°æœ€æ¥è¿‘çš„é¸é …
        const backTimeSelect = document.getElementById("backTime")
        const options = Array.from(backTimeSelect.options)

        // æ‰¾åˆ°æœ€æ¥è¿‘æˆ–ç­‰æ–¼è¨ˆç®—çµæœçš„æ™‚é–“é¸é …
        let bestOption = options[0]
        let minDiff = Infinity

        for (const option of options) {
          if (!option.value) continue // è·³éç©ºé¸é …

          const [optHour, optMinute] = option.value.split(":").map(Number)
          const optTotalMinutes = optHour * 60 + optMinute
          const endTotalMinutes = endHour * 60 + startMinute

          const diff = Math.abs(optTotalMinutes - endTotalMinutes)

          if (diff < minDiff) {
            minDiff = diff
            bestOption = option
          }
        }

        // è¨­å®šçµæŸæ™‚é–“
        backTimeSelect.value = bestOption.value
      }
      // åˆå§‹åŒ–æ—¥æœŸé¸æ“‡å™¨
      function initDatePickers() {
        const today = new Date()
        const sevenDaysAgo = new Date()
        sevenDaysAgo.setDate(today.getDate() - 7)
        const datePickerOptions = {
          locale: "zh_tw",
          dateFormat: "Y-m-d",
          disableMobile: true,
        }

        // åˆå§‹åŒ–æ‰€æœ‰æ—¥æœŸé¸æ“‡å™¨
        flatpickr("#startDate", {
          ...datePickerOptions,
          defaultDate: sevenDaysAgo,
        })

        flatpickr("#endDate", {
          ...datePickerOptions,
          defaultDate: today,
        })

        // å…¶ä»–æ—¥æœŸé¸æ“‡å™¨
        flatpickr("#leaveDate, #backDate", datePickerOptions)
      }

      // åˆå§‹åŒ– LIFF SDK
      async function initLIFF() {
        showLoading()
        try {
          await liff.init({ liffId: liffId })
          console.log("LIFF åˆå§‹åŒ–æˆåŠŸ")

          if (!liff.isLoggedIn()) {
            console.log("ç”¨æˆ¶æœªç™»å…¥ï¼Œå¼•å°ç™»å…¥...")
            liff.login()
            return
          }

          // ç”¨æˆ¶å·²ç™»å…¥ï¼Œå–å¾—ç”¨æˆ¶è³‡æ–™
          try {
            const profile = await liff.getProfile()
            console.log("ç²å–ç”¨æˆ¶è³‡æ–™æˆåŠŸ:", profile.displayName)

            // å­˜å„²LIFFæä¾›çš„userId
            const liffUserId = profile.userId

            // ä½¿ç”¨ç”¨æˆ¶ ID æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²å­˜åœ¨
            await checkAndLoadUserInfo(liffUserId)
          } catch (error) {
            console.error("ç²å–ç”¨æˆ¶è³‡æ–™å¤±æ•—:", error)
            showStatusMessage("ç„¡æ³•ç²å–ç”¨æˆ¶è³‡æ–™ï¼Œè«‹ç¢ºä¿å·²æˆæ¬Šæ‡‰ç”¨ç¨‹å¼", "error")
            hideLoading()
          }
        } catch (error) {
          console.error("LIFF åˆå§‹åŒ–å¤±æ•—:", error)
          showStatusMessage(
            "LINE æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯é€£æ¥ä¸¦é‡æ–°å˜—è©¦",
            "error"
          )
          hideLoading()
        }
      }

      // æª¢æŸ¥ä¸¦è¼‰å…¥ç”¨æˆ¶è³‡è¨Š
      async function checkAndLoadUserInfo(userId) {
        try {
          // å…ˆè¨­ç½® userId ç‚º LIFF æä¾›çš„å€¼
          if (!currentUser) {
            currentUser = {
              userId: userId,
            }
          }

          const response = await fetch(`${base_url}User/checkUser`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId: userId, channelId: channelId }),
          })

          if (response.status === 200) {
            // æ›´æ–°å…¶ä»–ä½¿ç”¨è€…è³‡è¨Šï¼Œä½†ä¿ç•™ userId
            const userData = await response.json()
            console.log("ç²å–åˆ°çš„ç”¨æˆ¶è³‡è¨Š:", userData)
            currentUser = {
              ...userData,
              userId: userId, // ç¢ºä¿ä½¿ç”¨ LIFF æä¾›çš„ userId
            }

            // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
            displayUserInfo(currentUser)

            // è¼‰å…¥ç”³è«‹é …ç›®
            await loadEventItems()

            // è¼‰å…¥æ½›åœ¨çš„æ ¸å‡†ä¸»ç®¡
            await loadPotentialApprovers()

            // è¼‰å…¥ç”³è«‹è¨˜éŒ„
            await loadRecords()
          } else {
            showStatusMessage("ç„¡æ³•ç²å–ç”¨æˆ¶è³‡è¨Šï¼Œè«‹å…ˆå®Œæˆè¨»å†Š", "error")
            setTimeout(() => {
              // è·³è½‰åˆ°è¨»å†Šé é¢
              window.location.href = "register.html"
            }, 2000)
          }
        } catch (error) {
          console.error("æª¢æŸ¥ç”¨æˆ¶è³‡è¨Šå¤±æ•—:", error)
          showStatusMessage("æª¢æŸ¥ç”¨æˆ¶è³‡è¨Šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°å˜—è©¦", "error")
        } finally {
          hideLoading()
        }
      }

      // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
      function displayUserInfo(user) {
        const userInfoElement = document.getElementById("userInfo")
        userInfoElement.innerHTML = `
    <strong>${user.name || "ä½¿ç”¨è€…"}${
          user.empId ? " (" + user.empId + ")" : ""
        }</strong> - 
    ${user.company || ""} ${user.dept || ""} ${user.job || ""}
  `
        userInfoElement.classList.remove("hidden")
      }
      // è¼‰å…¥ç”³è«‹é …ç›®
      async function loadEventItems() {
        try {
          const response = await fetch(`${base_url}Leave/items`, {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          })

          if (response.ok) {
            eventItems = await response.json()
            console.log("ç°½æ ¸é …ç›®:", eventItems)

            // æ•´ç†é¡åˆ¥
            categories = [...new Set(eventItems.map((item) => item.catalog))]
            console.log("é¡åˆ¥:", categories)

            // åˆå§‹åŒ–é¡åˆ¥é¸é …
            initCategoryTabs()
          } else {
            console.error("ç²å–ç”³è«‹é …ç›®å¤±æ•—:", response.status)
            showStatusMessage("ç„¡æ³•ç²å–ç°½æ ¸é …ç›®ï¼Œè«‹é‡æ–°å˜—è©¦", "error")
          }
        } catch (error) {
          console.error("è¼‰å…¥ç”³è«‹é …ç›®å¤±æ•—:", error)
          showStatusMessage("è¼‰å…¥ç°½æ ¸é …ç›®æ™‚ç™¼ç”ŸéŒ¯èª¤", "error")
        }
      }

      // è¼‰å…¥æ½›åœ¨çš„æ ¸å‡†ä¸»ç®¡
      // è·ç¨±æ’åºæ¬Šé‡ (æ•¸å­—è¶Šå¤§æ¬Šé‡è¶Šé«˜)
      const jobRankingMap = {
        è‘£äº‹é•·: 17,
        ç¸½ç¶“ç†: 16,
        åŸ·è‘£: 15,
        ç¶“ç†: 14,
        ä¸»ä»»: 13,
        å‰¯ç†: 12,
        è¥„ç†: 11,
        èª²é•·: 10,
        å‰¯èª²é•·: 9,
        ç«™é•·: 8,
        å‰¯ç«™é•·: 7,
        å» é•·: 6,
        å‰¯å» é•·: 5,
        è‚¡é•·: 4,
        å‰¯è‚¡é•·: 3,
        çµ„é•·: 2,
        å‰¯çµ„é•·: 1,
      }

      // æ ¹æ“šè·ç¨±æ’åº
      function sortUsersByJobRank(users) {
        return users.sort((a, b) => {
          const aRank = getJobRank(a.job)
          const bRank = getJobRank(b.job)
          return bRank - aRank // å¾é«˜åˆ°ä½æ’åº
        })
      }

      // ç²å–è·ç¨±æ¬Šé‡
      function getJobRank(job) {
        if (!job) return 0

        // æª¢æŸ¥è·ç¨±ä¸­æ˜¯å¦åŒ…å«é—œéµå­—
        for (const [keyword, rank] of Object.entries(jobRankingMap)) {
          if (job.includes(keyword)) {
            return rank
          }
        }
        return 0 // å…¶ä»–è·ç¨±é»˜èªæ¬Šé‡ç‚º0
      }

      // è¼‰å…¥å…¬å¸åˆ—è¡¨
      async function loadCompanies() {
        try {
          const response = await fetch(`${base_url}Leave/companies`, {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          })

          if (response.ok) {
            const companies = await response.json()
            const selectElement = document.getElementById("otherCompany")
            selectElement.innerHTML = '<option value="">è«‹é¸æ“‡å…¬å¸</option>'

            companies.forEach((company) => {
              const option = document.createElement("option")
              option.value = company
              option.textContent = company
              selectElement.appendChild(option)
            })
          } else {
            console.error("ç²å–å…¬å¸åˆ—è¡¨å¤±æ•—:", response.status)
            showStatusMessage("ç„¡æ³•ç²å–å…¬å¸åˆ—è¡¨", "error")
          }
        } catch (error) {
          console.error("è¼‰å…¥å…¬å¸åˆ—è¡¨å¤±æ•—:", error)
          showStatusMessage("è¼‰å…¥å…¬å¸åˆ—è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤", "error")
        }
      }

      // è¼‰å…¥éƒ¨é–€åˆ—è¡¨
      async function loadDepartments(company = null) {
        try {
          let url = `${base_url}Leave/departments`
          if (company) {
            url += `?company=${encodeURIComponent(company)}`
          }

          const response = await fetch(url, {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          })

          if (response.ok) {
            const departments = await response.json()
            const selectElement = document.getElementById("otherDept")
            selectElement.innerHTML = '<option value="">è«‹é¸æ“‡éƒ¨é–€</option>'

            departments.forEach((dept) => {
              const option = document.createElement("option")
              option.value = dept
              option.textContent = dept
              selectElement.appendChild(option)
            })
          } else {
            console.error("ç²å–éƒ¨é–€åˆ—è¡¨å¤±æ•—:", response.status)
            showStatusMessage("ç„¡æ³•ç²å–éƒ¨é–€åˆ—è¡¨", "error")
          }
        } catch (error) {
          console.error("è¼‰å…¥éƒ¨é–€åˆ—è¡¨å¤±æ•—:", error)
          showStatusMessage("è¼‰å…¥éƒ¨é–€åˆ—è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤", "error")
        }
      }

      async function loadPotentialApprovers() {
        try {
          const approverType = document.getElementById("approverType").value
          let url = `${base_url}Leave/approvers?excludeUserId=${currentUser.userId}`

          console.log("è¼‰å…¥æ ¸å‡†äººå“¡ - é¡å‹:", approverType)
          console.log("ç•¶å‰ç”¨æˆ¶è³‡è¨Š:", currentUser)

          if (approverType === "same-dept") {
            // è¼‰å…¥åŒéƒ¨é–€äººå“¡
            url += `&company=${encodeURIComponent(
              currentUser.company
            )}&dept=${encodeURIComponent(currentUser.dept)}`
          } else if (approverType === "other-dept") {
            // è¼‰å…¥å…¶ä»–éƒ¨é–€äººå“¡ (æ’é™¤é§•é§›é•·)
            const selectedDept = document.getElementById("otherDept").value
            if (!selectedDept) {
              showStatusMessage("è«‹å…ˆé¸æ“‡éƒ¨é–€", "error")
              return
            }
            url += `&company=${encodeURIComponent(
              currentUser.company
            )}&dept=${encodeURIComponent(selectedDept)}&excludeJob=é§•é§›é•·`
          } else if (approverType === "other-company") {
            // è¼‰å…¥å…¶ä»–å…¬å¸åˆ¥çš„å…¼ä»»ä¸»ç®¡
            const selectedCompany =
              document.getElementById("otherCompany").value
            const selectedDept = document.getElementById("otherDept").value

            console.log("é¸æ“‡çš„å…¬å¸:", selectedCompany)
            console.log("é¸æ“‡çš„éƒ¨é–€:", selectedDept)

            if (!selectedCompany || !selectedDept) {
              showStatusMessage("è«‹å…ˆé¸æ“‡å…¬å¸å’Œéƒ¨é–€", "error")
              return
            }
            url += `&company=${encodeURIComponent(
              selectedCompany
            )}&dept=${encodeURIComponent(selectedDept)}&hasManagerRole=true`
          }

          console.log("æ­£åœ¨è¼‰å…¥æ ¸å‡†äººå“¡ï¼ŒAPI URL:", url)

          const response = await fetch(url, {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          })

          console.log("API å›æ‡‰ç‹€æ…‹:", response.status)

          if (response.ok) {
            let approversData = await response.json()
            console.log("å¾ API ç²å–çš„åŸå§‹è³‡æ–™:", approversData)

            // æ ¹æ“šè·ç¨±æ’åº
            approvers = sortUsersByJobRank(approversData)
            console.log("æ’åºå¾Œçš„æ ¸å‡†ä¸»ç®¡:", approvers)

            if (approvers.length === 0) {
              console.warn("æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ ¸å‡†äººå“¡")
              showStatusMessage(
                "æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ ¸å‡†äººå“¡ï¼Œè«‹æª¢æŸ¥è©²å…¬å¸éƒ¨é–€æ˜¯å¦æœ‰å…¼ä»»ä¸»ç®¡",
                "error"
              )
            }

            updateApproverOptions()
          } else {
            console.error("ç²å–ç°½æ ¸äººå“¡å¤±æ•—:", response.status)
            const errorText = await response.text()
            console.error("éŒ¯èª¤è©³æƒ…:", errorText)
            showStatusMessage(
              `ç„¡æ³•ç²å–ç°½æ ¸äººå“¡åˆ—è¡¨ (éŒ¯èª¤ä»£ç¢¼: ${response.status})`,
              "error"
            )
          }
        } catch (error) {
          console.error("è¼‰å…¥ç°½æ ¸äººå“¡å¤±æ•—:", error)
          showStatusMessage(
            "è¼‰å…¥ç°½æ ¸äººå“¡åˆ—è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤: " + error.message,
            "error"
          )
        }
      }
      // è¼‰å…¥ç”³è«‹è¨˜éŒ„
      async function loadRecords() {
        showLoading()
        try {
          let url, records

          if (currentStatus === "my-approved") {
            // è¼‰å…¥æˆ‘çš„æ ¸å‡†è¨˜éŒ„ - ä½¿ç”¨ searchDateType=approve
            const startDate = document.getElementById("startDate").value
            const endDate = document.getElementById("endDate").value

            url = `${base_url}Leave/approved-by-me?ApproverId=${currentUser.userId}&searchDateType=approve`

            // æ·»åŠ æ—¥æœŸæŸ¥è©¢åƒæ•¸
            if (startDate && endDate) {
              url += `&StartDate=${startDate}&EndDate=${endDate}`
            }

            const response = await fetch(url, {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            })

            if (response.ok) {
              records = await response.json()
              console.log("æˆ‘çš„æ ¸å‡†è¨˜éŒ„:", records)
            } else {
              console.error("ç²å–æˆ‘çš„æ ¸å‡†è¨˜éŒ„å¤±æ•—:", response.status)
              showStatusMessage("ç„¡æ³•ç²å–æˆ‘çš„æ ¸å‡†è¨˜éŒ„", "error")
              records = []
            }
          } else if (currentStatus === "pending-approval") {
            // è¼‰å…¥å¾…ç°½æ ¸è¨˜éŒ„ - é¡¯ç¤ºæŒ‡å®šè¦æˆ‘ç°½æ ¸ä¸”å°šæœªç°½æ ¸çš„è¨˜éŒ„
            url = `${base_url}Leave/leave?ApproveUserId=${currentUser.userId}&ApproveResult=pending`

            const response = await fetch(url, {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            })

            if (response.ok) {
              records = await response.json()
              console.log("å¾…æˆ‘ç°½æ ¸è¨˜éŒ„:", records)
            } else {
              console.error("ç²å–å¾…ç°½æ ¸è¨˜éŒ„å¤±æ•—:", response.status)
              showStatusMessage("ç„¡æ³•ç²å–å¾…ç°½æ ¸è¨˜éŒ„", "error")
              records = []
            }
          } else if (currentStatus === "pending") {
            // è¼‰å…¥å·²é€å‡ºè¨˜éŒ„ - ä¸ä½¿ç”¨æ—¥æœŸç¯©é¸ï¼Œè¨­å®šä¸€å¹´ç¯„åœ
            const today = new Date()
            const oneYearAgo = new Date()
            oneYearAgo.setFullYear(today.getFullYear() - 1)
            const oneYearLater = new Date()
            oneYearLater.setFullYear(today.getFullYear() + 1)

            const startDate = oneYearAgo.toISOString().split("T")[0]
            const endDate = oneYearLater.toISOString().split("T")[0]

            url = `${base_url}Leave/leave?UserId=${currentUser.userId}&ApproveResult=${currentStatus}&searchDateType=leave&StartDate=${startDate}&EndDate=${endDate}`

            const response = await fetch(url, {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            })

            if (response.ok) {
              records = await response.json()
              console.log("å·²é€å‡ºè¨˜éŒ„:", records)
            } else {
              console.error("ç²å–å·²é€å‡ºè¨˜éŒ„å¤±æ•—:", response.status)
              showStatusMessage("ç„¡æ³•ç²å–å·²é€å‡ºè¨˜éŒ„", "error")
              records = []
            }
          } else {
            // è¼‰å…¥ç”³è«‹è¨˜éŒ„ï¼ˆå·²æ ¸å‡†ã€å·²æ‹’çµ•ï¼‰- ä½¿ç”¨ searchDateType=leave
            const startDate = document.getElementById("startDate").value
            const endDate = document.getElementById("endDate").value

            // è‹¥æ²’æœ‰è¨­å®šæ—¥æœŸï¼Œé è¨­ç‚ºå‰7å¤©è‡³ä»Š
            if (!startDate || !endDate) {
              const today = new Date()
              const sevenDaysAgo = new Date()
              sevenDaysAgo.setDate(today.getDate() - 7)

              // æ ¼å¼åŒ–æ—¥æœŸç‚º YYYY-MM-DD
              endDate = today.toISOString().split("T")[0]
              startDate = sevenDaysAgo.toISOString().split("T")[0]

              // æ›´æ–°è¼¸å…¥æ¡†çš„å€¼
              document.getElementById("startDate").value = startDate
              document.getElementById("endDate").value = endDate
            }

            url = `${base_url}Leave/leave?UserId=${currentUser.userId}&ApproveResult=${currentStatus}&searchDateType=leave`

            // æ·»åŠ æ—¥æœŸæŸ¥è©¢åƒæ•¸
            if (startDate && endDate) {
              url += `&StartDate=${startDate}&EndDate=${endDate}`
            }

            const response = await fetch(url, {
              method: "GET",
              headers: { "Content-Type": "application/json" },
            })

            if (response.ok) {
              records = await response.json()
              console.log("ç”³è«‹è¨˜éŒ„:", records)
            } else {
              console.error("ç²å–ç”³è«‹è¨˜éŒ„å¤±æ•—:", response.status)
              showStatusMessage("ç„¡æ³•ç²å–ç°½æ ¸è¨˜éŒ„", "error")
              records = []
            }
          }

          // ä¾æ—¥æœŸæ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰
          records.sort((a, b) => {
            return new Date(b.leaveDate) - new Date(a.leaveDate)
          })

          // é¡¯ç¤ºè¨˜éŒ„
          displayRecords(records)
        } catch (error) {
          console.error("è¼‰å…¥è¨˜éŒ„å¤±æ•—:", error)
          showStatusMessage("è¼‰å…¥è¨˜éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤", "error")
          displayRecords([])
        } finally {
          hideLoading()
        }
      }

      // è¨­ç½®æ¿€æ´»çš„ç”³è«‹ç‹€æ…‹åˆ†é 
      function setActiveTab(status) {
        currentStatus = status

        // æ›´æ–° tab çš„æ¿€æ´»ç‹€æ…‹
        document.querySelectorAll(".tab").forEach((tab) => {
          if (tab.dataset.status === status) {
            tab.classList.add("active")
          } else {
            tab.classList.remove("active")
          }
        })

        // æ§åˆ¶æ—¥æœŸç¯©é¸å™¨çš„é¡¯ç¤º/éš±è—
        const searchBar = document.querySelector(".search-bar")
        if (status === "pending" || status === "pending-approval") {
          // å·²é€å‡ºåˆ†é å’Œå¾…ç°½æ ¸åˆ†é ï¼šéš±è—æ—¥æœŸç¯©é¸å™¨
          searchBar.style.display = "none"
        } else {
          // å…¶ä»–åˆ†é ï¼šé¡¯ç¤ºæ—¥æœŸç¯©é¸å™¨
          searchBar.style.display = "flex"
        }
      }
      // é¡¯ç¤ºç”³è«‹è¨˜éŒ„
      function displayRecords(records) {
        const recordsListElement = document.getElementById("recordsList")

        if (!recordsListElement) {
          console.error("æ‰¾ä¸åˆ°è¨˜éŒ„åˆ—è¡¨å…ƒç´ ")
          return
        }

        if (!records || records.length === 0) {
          // ç›´æ¥è¨­ç½®ç©ºè¨˜éŒ„è¨Šæ¯
          recordsListElement.innerHTML =
            '<div class="empty-list">ç„¡ç°½æ ¸è¨˜éŒ„</div>'
          return
        }

        let html = ""
        const isMyApproved = currentStatus === "my-approved"
        const isPendingApproval = currentStatus === "pending-approval"
        const isPending = currentStatus === "pending"
        const isPassOrReject =
          currentStatus === "pass" || currentStatus === "reject"

        records.forEach((record) => {
          // æ ¼å¼åŒ–ç‹€æ…‹é¡¯ç¤º
          let statusClass = ""
          let statusText = ""

          if (isMyApproved) {
            statusClass = "status-approved"
            statusText = "å·²æ ¸å‡†"
          } else if (isPendingApproval) {
            statusClass = "status-pending"
            statusText = "å¾…ç°½æ ¸"
          } else {
            switch (record.approveResult) {
              case "pending":
                statusClass = "status-pending"
                statusText = "ç°½æ ¸ä¸­"
                break
              case "pass":
                statusClass = "status-approved"
                statusText = "æ ¸å‡†"
                break
              case "reject":
                statusClass = "status-rejected"
                statusText = "ä¸æ ¸æº–(è«‹è¯ç¹«ç°½æ ¸äººå“¡)"
                break
            }
          }

          // åªæœ‰åœ¨ pending ç‹€æ…‹æ™‚æ‰é¡¯ç¤ºæ’¤éŠ·æŒ‰éˆ•ï¼ˆéå¾…ç°½æ ¸åˆ†é ï¼‰
          const cancelButton =
            record.approveResult === "pending" &&
            !isMyApproved &&
            !isPendingApproval
              ? `<button class="cancel-btn button danger-button" onclick="confirmCancelApplication('${record.id}')">å–æ¶ˆç”³è«‹</button>`
              : ""

          // æ ¸å‡†/ä¸æ ¸å‡†æŒ‰éˆ•ï¼ˆåƒ…åœ¨å¾…ç°½æ ¸åˆ†é é¡¯ç¤ºï¼‰
          const approvalButtons = isPendingApproval
            ? `<div class="approval-buttons">
                <button class="approve-btn button success-button" onclick="showApprovalDialog('${record.id}', 'pass')">æ ¸å‡†</button>
                <button class="reject-btn button danger-button" onclick="showApprovalDialog('${record.id}', 'reject')">ä¸æ ¸å‡†</button>
              </div>`
            : ""

          // å¿«é€Ÿä¿®æ”¹ FromBackCmpy æŒ‰éˆ•ï¼ˆåƒ…åœ¨æˆ‘çš„æ ¸å‡†åˆ†é é¡¯ç¤ºï¼‰
          const quickEditButtons = isMyApproved
            ? `<div class="quick-edit-buttons">
                <button class="quick-edit-btn general ${
                  !record.fromBackCmpy || record.fromBackCmpy === ""
                    ? "active"
                    : ""
                }" 
                        onclick="quickUpdateFromBackCmpy('${record.id}', '')" 
                        title="è¨­ç‚ºä¸€èˆ¬å…¬å‡º">ä¸€èˆ¬</button>
                <button class="quick-edit-btn go ${
                  record.fromBackCmpy === "é€•å¾€" ? "active" : ""
                }" 
                        onclick="quickUpdateFromBackCmpy('${
                          record.id
                        }', 'é€•å¾€')" 
                        title="è¨­ç‚ºé€•å¾€">é€•å¾€</button>
                <button class="quick-edit-btn back ${
                  record.fromBackCmpy === "é€•è¿”" ? "active" : ""
                }" 
                        onclick="quickUpdateFromBackCmpy('${
                          record.id
                        }', 'é€•è¿”')" 
                        title="è¨­ç‚ºé€•è¿”">é€•è¿”</button>
                <button class="quick-edit-btn both ${
                  record.fromBackCmpy === "é€•å¾€åŠé€•è¿”" ? "active" : ""
                }" 
                        onclick="quickUpdateFromBackCmpy('${
                          record.id
                        }', 'é€•å¾€åŠé€•è¿”')" 
                        title="è¨­ç‚ºé€•å¾€åŠé€•è¿”">å¾€è¿”</button>
              </div>`
            : ""

          // FromBackCmpy ç‹€æ…‹é¡¯ç¤ºï¼ˆåœ¨å·²é€å‡ºã€å¾…ç°½æ ¸ã€æˆ‘çš„æ ¸å‡†åˆ†é ã€å·²æ ¸å‡†å’Œä¸æ ¸æº–åˆ†é é¡¯ç¤ºï¼‰
          const fromBackDisplay =
            (isPending ||
              isPendingApproval ||
              isMyApproved ||
              isPassOrReject) &&
            record.fromBackCmpy
              ? `<br>é¡å‹ï¼š<span class="fromback-highlight">${
                  record.fromBackCmpy === "é€•å¾€"
                    ? "é€•å¾€"
                    : record.fromBackCmpy === "é€•è¿”"
                    ? "é€•è¿”"
                    : record.fromBackCmpy === "é€•å¾€åŠé€•è¿”"
                    ? "é€•å¾€åŠé€•è¿”"
                    : "ä¸€èˆ¬å…¬å‡º"
                }</span>`
              : ""

          // ç”³è«‹äººè³‡è¨Šï¼ˆåœ¨æˆ‘çš„æ ¸å‡†åˆ†é å’Œå¾…ç°½æ ¸åˆ†é é¡¯ç¤ºï¼‰
          const applicantInfo =
            isMyApproved || isPendingApproval
              ? `<br>ç”³è«‹äºº: ${record.empId || ""} ${record.name || ""} (${
                  record.dept || ""
                })`
              : ""

          html += `
        <div class="record-item" data-id="${record.id}">
          <div class="record-content">
            <div class="record-header">
              <div class="record-title">
                ${record.eventCatalog}é¡- ${record.eventName}
                ${applicantInfo}
              </div>
              <div class="record-date">${record.leaveDate} ${
            record.leaveTime
          }</div>
            </div>
            <div class="record-details">
              
              ${record.desc}
              ${record.location ? `<br>åœ°é»: ${record.location}` : ""}
              ${
                record.backDate
                  ? `<br>é–‹å§‹æ™‚é–“: ${record.leaveDate} ${record.leaveTime}`
                  : ""
              }
              ${
                record.backTime
                  ? `<br>é è¨ˆè¿”å›: ${record.backDate} ${record.backTime}`
                  : ""
              }
              ${fromBackDisplay}
            </div>
            <div class="record-actions">
              ${cancelButton}
              ${approvalButtons}
              ${quickEditButtons}
            </div>
          </div>
        </div>
      `
        })

        recordsListElement.innerHTML = html
      }
      // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
      function showConfirmDialog(message, callback) {
        const confirmMessageElement = document.getElementById("confirmMessage")
        confirmMessageElement.textContent = message

        confirmCallback = callback

        document.getElementById("confirmModal").classList.remove("hidden")
      }

      // åˆå§‹åŒ–é¡åˆ¥åˆ†é 
      function initCategoryTabs() {
        const categoryTabsElement = document.getElementById("categoryTabs")
        let html = ""

        categories.forEach((category, index) => {
          html += `<div class="category-tab${
            index === 0 ? " active" : ""
          }" data-category="${category}">${category}</div>`
        })

        categoryTabsElement.innerHTML = html

        // ç¬¬ä¸€å€‹é¡åˆ¥ç‚ºé»˜èªé¸ä¸­
        if (categories.length > 0) {
          currentCategory = categories[0]
          updateEventItemOptions(currentCategory)
        }

        // æ·»åŠ é¡åˆ¥é»æ“Šäº‹ä»¶
        document.querySelectorAll(".category-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            const category = tab.dataset.category
            currentCategory = category

            // æ›´æ–°æ¿€æ´»ç‹€æ…‹
            document.querySelectorAll(".category-tab").forEach((t) => {
              t.classList.toggle("active", t === tab)
            })

            // æ›´æ–°é …ç›®é¸æ“‡
            updateEventItemOptions(category)
            // æ·»åŠ ï¼šæ»¾å‹•å‹•ç•«æ•ˆæœï¼Œæå‡ç”¨æˆ¶é«”é©—
            tab.style.transition = "all 0.3s"
            setTimeout(() => {
              tab.style.transition = ""
            }, 300)
          })
        })
      }
      // æ›´æ–°é …ç›®é¸æ“‡ä¸‹æ‹‰é¸å–®
      function updateEventItemOptions(category) {
        const selectElement = document.getElementById("eventItem")
        selectElement.innerHTML = '<option value="">è«‹é¸æ“‡ç°½æ ¸é …ç›®</option>'

        const filteredItems = eventItems.filter(
          (item) => item.catalog === category
        )

        filteredItems.forEach((item) => {
          // ä¿®æ”¹é€™è£¡: ä¸å†ä½¿ç”¨ JSON.stringifyï¼Œè€Œæ˜¯åªå„²å­˜é …ç›®åç¨±
          const option = document.createElement("option")
          option.value = item.itemName // åªå„²å­˜ itemName å­—ä¸²å€¼
          option.textContent = item.itemName
          option.dataset.catalog = item.catalog // ä½¿ç”¨ dataset å„²å­˜ catalog
          selectElement.appendChild(option)
        })
      }

      // é¡¯ç¤ºæ–°å¢ç”³è«‹å°è©±æ¡†
      function showNewApplicationModal() {
        // é‡ç½®è¡¨å–®
        document.getElementById("applicationForm").reset()

        // é‡ç½®é€•å¾€é€•è¿”é¸é …ç‚ºé è¨­å€¼ï¼ˆä¸€èˆ¬ï¼‰
        document
          .querySelectorAll("#applicationForm .fromback-option")
          .forEach((opt) => {
            opt.classList.remove("selected")
          })
        document
          .querySelector("#applicationForm .fromback-option[data-value='']")
          .classList.add("selected")
        document.getElementById("fromBackCmpy").value = ""

        // é‡ç½®ç°½æ ¸ç¯„åœç‚ºé è¨­å€¼ï¼ˆæœ¬éƒ¨é–€ï¼‰
        document.getElementById("approverType").value = "same-dept"
        document.getElementById("otherCompanyGroup").style.display = "none"
        document.getElementById("otherDeptGroup").style.display = "none"

        // è¼‰å…¥åŒéƒ¨é–€çš„ç°½æ ¸äººå“¡
        loadPotentialApprovers()

        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        document
          .getElementById("newApplicationModal")
          .classList.remove("hidden")
      }
      // æ¸…é™¤æ™‚é–“é¸æ“‡
      function clearTimeSelections() {
        document.getElementById("leaveTime").value = ""
        document.getElementById("backTime").value = ""
      }

      // æ›´æ–°ä¸»ç®¡é¸æ“‡ä¸‹æ‹‰é¸å–®
      function updateApproverOptions() {
        const selectElement = document.getElementById("approveUserId")
        selectElement.innerHTML = '<option value="">è«‹é¸æ“‡ç°½æ ¸äººå“¡</option>'

        approvers.forEach((approver) => {
          const option = document.createElement("option")
          option.value = approver.userId
          option.textContent = `${approver.name} (${approver.job || "æœªè¼¸å…¥"})`
          selectElement.appendChild(option)
        })
      }
      // é¡¯ç¤ºéŒ¯èª¤æç¤º
      function showError(fieldId, message) {
        const field = document.getElementById(fieldId)
        field.classList.add("error")

        const errorTooltip = document.getElementById(`${fieldId}-error`)
        if (errorTooltip) {
          errorTooltip.textContent = message
          errorTooltip.style.display = "block"

          // 2ç§’å¾Œè‡ªå‹•éš±è—éŒ¯èª¤æç¤º
          setTimeout(() => {
            errorTooltip.style.display = "none"
            field.classList.remove("error")
          }, 3000)
        }

        return false
      }

      // é©—è­‰ä¸¦é€å‡ºç”³è«‹
      function validateAndSubmitApplication() {
        // éš±è—æ‰€æœ‰éŒ¯èª¤æç¤º
        document.querySelectorAll(".error-tooltip").forEach((tooltip) => {
          tooltip.style.display = "none"
        })

        let isValid = true

        // é©—è­‰ç”³è«‹é …ç›®
        const eventItemValue = document.getElementById("eventItem").value
        if (!eventItemValue) {
          isValid = showError("eventItem", "è«‹é¸æ“‡ç°½æ ¸é …ç›®") && isValid
        }

        // é©—è­‰ç”³è«‹æ—¥æœŸ
        const leaveDate = document.getElementById("leaveDate").value
        if (!leaveDate) {
          isValid = showError("leaveDate", "è«‹é¸æ“‡é–‹å§‹æ—¥æœŸ") && isValid
        }

        // é©—è­‰ç”³è«‹æ™‚é–“
        const leaveTime = document.getElementById("leaveTime").value
        if (!leaveTime) {
          isValid = showError("leaveTime", "è«‹é¸æ“‡é–‹å§‹æ™‚é–“") && isValid
        }

        // é©—è­‰çµæŸæ—¥æœŸï¼ˆç¾åœ¨æ”¹ç‚ºå¿…å¡«ï¼‰
        const backDate = document.getElementById("backDate").value
        if (!backDate) {
          isValid = showError("backDate", "è«‹é¸æ“‡çµæŸæ—¥æœŸ") && isValid
        } else if (leaveDate && new Date(backDate) < new Date(leaveDate)) {
          isValid =
            showError("backDate", "çµæŸæ—¥æœŸå¿…é ˆåœ¨é–‹å§‹æ—¥æœŸä¹‹å¾Œ") && isValid
        }

        // é©—è­‰çµæŸæ™‚é–“ï¼ˆç¾åœ¨æ”¹ç‚ºå¿…å¡«ï¼‰
        const backTime = document.getElementById("backTime").value
        if (!backTime) {
          isValid = showError("backTime", "è«‹é¸æ“‡çµæŸæ™‚é–“") && isValid
        }

        // é©—è­‰åŒä¸€å¤©æ™‚é–“é †åº
        if (
          backDate &&
          leaveDate &&
          backDate === leaveDate &&
          backTime &&
          leaveTime
        ) {
          if (backTime < leaveTime) {
            isValid =
              showError("backTime", "çµæŸæ™‚é–“å¿…é ˆæ™šæ–¼é–‹å§‹æ™‚é–“") && isValid
          }
        }

        // é©—è­‰æ ¸å‡†ä¸»ç®¡
        const approveUserId = document.getElementById("approveUserId").value
        if (!approveUserId) {
          isValid = showError("approveUserId", "è«‹é¸æ“‡ç°½æ ¸äººå“¡") && isValid
        }

        // é©—è­‰ç°½æ ¸ç¯„åœç›¸é—œé¸é …
        const approverType = document.getElementById("approverType").value
        if (approverType === "other-dept") {
          const otherDept = document.getElementById("otherDept").value
          if (!otherDept) {
            isValid = showError("otherDept", "è«‹é¸æ“‡éƒ¨é–€") && isValid
          }
        } else if (approverType === "other-company") {
          const otherCompany = document.getElementById("otherCompany").value
          const otherDept = document.getElementById("otherDept").value
          if (!otherCompany) {
            isValid = showError("otherCompany", "è«‹é¸æ“‡å…¬å¸") && isValid
          }
          if (!otherDept) {
            isValid = showError("otherDept", "è«‹é¸æ“‡éƒ¨é–€") && isValid
          }
        }

        // é©—è­‰ç”³è«‹èªªæ˜
        const desc = document.getElementById("desc").value.trim()
        if (!desc) {
          isValid = showError("desc", "è«‹è¼¸å…¥äº‹ç”±") && isValid
        }

        if (!isValid) {
          return
        }

        // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
        showConfirmDialog("æ‚¨ç¢ºå®šè¦é€å‡ºç”³è«‹å—ï¼Ÿ", submitApplication)
      }

      // é€å‡ºç”³è«‹
      async function submitApplication() {
        showLoading()

        try {
          const eventItemSelect = document.getElementById("eventItem")
          const eventItemValue = eventItemSelect.value
          const eventCatalog =
            eventItemSelect.options[eventItemSelect.selectedIndex].dataset
              .catalog

          const applicationData = {
            userId: currentUser.userId,
            channelId: channelId,
            company: currentUser.company,
            dept: currentUser.dept,
            empId: currentUser.empId,
            name: currentUser.name,
            leaveDate: document.getElementById("leaveDate").value,
            leaveTime: document.getElementById("leaveTime").value,
            backDate: document.getElementById("backDate").value,
            backTime: document.getElementById("backTime").value,
            location: document.getElementById("location").value || null,
            eventName: eventItemValue,
            eventCatalog: eventCatalog,
            desc: document.getElementById("desc").value,
            approveUserId: document.getElementById("approveUserId").value,
            fromBackCmpy: document.getElementById("fromBackCmpy").value || null,
          }

          const response = await fetch(`${base_url}Leave/createLeave`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(applicationData),
          })

          if (response.ok) {
            showStatusMessage("ç°½æ ¸å·²æˆåŠŸé€å‡º", "success")
            document
              .getElementById("newApplicationModal")
              .classList.add("hidden")
            await loadRecords()
          } else {
            // åœ¨ modal å…§é¡¯ç¤ºéŒ¯èª¤
            let errorMessage = "é€å‡ºç°½æ ¸å¤±æ•—"
            try {
              const errorData = await response.json()
              errorMessage = errorData.message || errorMessage
            } catch (parseError) {
              console.error("è§£æéŒ¯èª¤å›æ‡‰å¤±æ•—:", parseError)
            }

            // åœ¨ modal å…§é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            showModalError(errorMessage)
          }
        } catch (error) {
          console.error("é€å‡ºç°½æ ¸å¤±æ•—:", error)
          showStatusMessage("é€å‡ºç°½æ ¸æ™‚ç™¼ç”ŸéŒ¯èª¤", "error")
        } finally {
          hideLoading()
        }
      }

      // æ–°å¢çš„å‡½æ•¸ï¼Œç”¨æ–¼åœ¨ modal å…§é¡¯ç¤ºéŒ¯èª¤
      function showModalError(message) {
        showStatusMessage(message, "error")
      }
      // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
      function showStatusMessage(message, type) {
        if (type === "error") {
          // ä½¿ç”¨å…¨åŸŸæµ®å‹•æç¤ºé¡¯ç¤ºéŒ¯èª¤
          const tooltipElement = document.getElementById("globalErrorTooltip")
          tooltipElement.textContent = message
          tooltipElement.style.display = "block"

          // 3ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
          setTimeout(() => {
            tooltipElement.style.display = "none"
          }, 3000)
        } else {
          // æˆåŠŸå’Œä¿¡æ¯è¨Šæ¯ä¿æŒåŸæ¨£
          const statusElement = document.getElementById("statusMessage")
          statusElement.textContent = message
          statusElement.className = "status-message"
          statusElement.classList.add(type)

          // 3ç§’å¾Œè‡ªå‹•éš±è—æˆåŠŸè¨Šæ¯
          if (type === "success") {
            setTimeout(() => {
              statusElement.style.display = "none"
            }, 3000)
          }
        }
      }

      // é¡¯ç¤ºè¼‰å…¥ä¸­
      function showLoading() {
        document.getElementById("loading-overlay").classList.remove("hidden")
      }

      // éš±è—è¼‰å…¥ä¸­
      function hideLoading() {
        document.getElementById("loading-overlay").classList.add("hidden")
      }

      // å®‰å…¨åœ°é—œé–‰è¦–çª—ï¼ˆå¦‚æœåœ¨ LINE ç€è¦½å™¨å…§ï¼‰
      function closeWindowSafely() {
        console.log("å˜—è©¦é—œé–‰çª—å£...")

        if (liff && liff.isInClient()) {
          try {
            console.log("åœ¨ LINE å…§éƒ¨ï¼Œä½¿ç”¨ liff.closeWindow()")
            liff.closeWindow()
          } catch (e) {
            console.error("é—œé–‰çª—å£å¤±æ•—:", e)
            showStatusMessage("ç„¡æ³•è‡ªå‹•è¿”å›èŠå¤©å®¤ï¼Œè«‹æ‰‹å‹•é—œé–‰è¦–çª—", "info")
          }
        } else {
          console.log("ä¸åœ¨ LINE ç€è¦½å™¨å…§ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯")
          showStatusMessage("æ“ä½œå·²å®Œæˆã€‚è«‹æ‰‹å‹•é—œé–‰æ­¤è¦–çª—", "info")
        }
      }
      // æ–°å¢ï¼šåœ¨é¡¯ç¤ºå°è©±æ¡†å‡½æ•¸ä¸­æ·»åŠ è‡ªå‹•æ»¾åŠ¨åˆ°è¦–åœ–ä¸­é–“çš„é‚è¼¯
      function showNewApplicationModal() {
        // é‡ç½®è¡¨å–®
        document.getElementById("applicationForm").reset()

        // æ›´æ–°ä¸»ç®¡é¸æ“‡ä¸‹æ‹‰é¸å–®
        updateApproverOptions()

        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        const modal = document.getElementById("newApplicationModal")
        modal.classList.remove("hidden")

        // æ–°å¢ï¼šç¢ºä¿æ¨¡æ…‹æ¡†ç½®ä¸­
        setTimeout(() => {
          const modalContent = modal.querySelector(".modal")
          if (modalContent) {
            // æ»¾å‹•åˆ°é é¢é ‚éƒ¨ï¼Œç„¶å¾Œæ¨¡æ…‹æ¡†æœƒè‡ªå‹•ç½®ä¸­
            window.scrollTo({
              top: 0,
              behavior: "smooth",
            })
          }
        }, 100)
      }

      // åŠ å…¥ã€Œç¢ºèªæ’¤éŠ·ç”³è«‹ã€å‡½æ•¸
      function confirmCancelApplication(id) {
        // æª¢æŸ¥æ˜¯å¦ç‚ºã€Œæ’¤éŠ·ç”³è«‹ã€ç‹€æ…‹ä¸‹æ‰èƒ½æ’¤éŠ·
        const currentDate = new Date()
        const recordItem = document.querySelector(
          `.record-item[data-id="${id}"]`
        )

        if (!recordItem) {
          showStatusMessage("æ‰¾ä¸åˆ°æ­¤ç°½æ ¸è¨˜éŒ„", "error")
          return
        }

        // åªæœ‰ç”³è«‹ä¸­ç‹€æ…‹æ‰èƒ½æ’¤éŠ·
        const statusElement = recordItem.querySelector(".record-status")
        if (
          statusElement &&
          !statusElement.classList.contains("status-pending")
        ) {
          showStatusMessage("åªæœ‰ç°½æ ¸ä¸­çš„ç‹€æ…‹å¯ä»¥æ’¤éŠ·", "error")
          return
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºè·¨æœˆç”³è«‹
        /*
        const leaveDateStr = recordItem
          .querySelector(".record-date")
          .textContent.split(" ")[0]
        const leaveDate = new Date(leaveDateStr)

        if (
          leaveDate.getFullYear() !== currentDate.getFullYear() ||
          leaveDate.getMonth() !== currentDate.getMonth()
        ) {
          showStatusMessage("è·¨æœˆè¨˜éŒ„ç„¡æ³•æ’¤éŠ·", "error")
          return
        }
        */
        // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
        showConfirmDialog("æ‚¨ç¢ºå®šè¦æ’¤éŠ·æ­¤ç°½æ ¸å—ï¼Ÿ", () => cancelApplication(id))
      }

      // æ–°å¢ã€ŒåŸ·è¡Œæ’¤éŠ·ç”³è«‹ã€å‡½æ•¸
      async function cancelApplication(id) {
        showLoading()

        try {
          // æº–å‚™è«‹æ±‚è³‡æ–™
          const cancelData = {
            userId: currentUser.userId,
          }

          // ç™¼é€æ’¤éŠ·è«‹æ±‚
          const response = await fetch(`${base_url}Leave/${id}/cancel`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(cancelData),
          })

          if (response.ok) {
            showStatusMessage("ç°½æ ¸å·²æˆåŠŸæ’¤éŠ·", "success")
            // é‡æ–°è¼‰å…¥ç”³è«‹è¨˜éŒ„
            await loadRecords()
          } else {
            // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            let errorMessage = "æ’¤éŠ·ç°½æ ¸å¤±æ•—"
            try {
              const errorData = await response.json()
              errorMessage = errorData.message || errorMessage
            } catch (parseError) {
              console.error("è§£æéŒ¯èª¤å›æ‡‰å¤±æ•—:", parseError)
            }

            showStatusMessage(errorMessage, "error")
          }
        } catch (error) {
          console.error("æ’¤éŠ·ç°½æ ¸å¤±æ•—:", error)
          showStatusMessage("æ’¤éŠ·ç°½æ ¸æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦", "error")
        } finally {
          hideLoading()
        }
      }

      // ç§»é™¤æ‰¹é‡æ“ä½œç›¸é—œå‡½æ•¸ï¼Œæ”¹ç‚ºå–®ç­†å¿«é€Ÿä¿®æ”¹

      // é¡¯ç¤ºæ ¸å‡†/ä¸æ ¸å‡†ç¢ºèªå°è©±æ¡†
      function showApprovalDialog(recordId, action) {
        const actionText = action === "pass" ? "æ ¸å‡†" : "ä¸æ ¸å‡†"
        const message = `æ‚¨ç¢ºå®šè¦${actionText}æ­¤ç”³è«‹å—ï¼Ÿ`

        showConfirmDialog(message, () => handleApproval(recordId, action))
      }

      // è™•ç†æ ¸å‡†/ä¸æ ¸å‡†æ“ä½œ
      async function handleApproval(recordId, action) {
        try {
          showLoading()

          const approvalData = {
            approverId: currentUser.userId,
            result: action,
            description: action === "pass" ? "æ ¸å‡†é€šé" : "ä¸äºˆæ ¸å‡†",
          }

          const response = await fetch(`${base_url}Leave/${recordId}/approve`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(approvalData),
          })

          if (response.ok) {
            const actionText = action === "pass" ? "æ ¸å‡†" : "ä¸æ ¸å‡†"
            showStatusMessage(`ç”³è«‹å·²${actionText}`, "success")
            // é‡æ–°è¼‰å…¥è¨˜éŒ„ä»¥æ›´æ–°åˆ—è¡¨
            await loadRecords()
          } else {
            let errorMessage = `${action === "pass" ? "æ ¸å‡†" : "ä¸æ ¸å‡†"}å¤±æ•—`
            try {
              const errorData = await response.json()
              errorMessage = errorData.message || errorMessage
            } catch (parseError) {
              console.error("è§£æéŒ¯èª¤å›æ‡‰å¤±æ•—:", parseError)
            }
            showStatusMessage(errorMessage, "error")
          }
        } catch (error) {
          console.error("è™•ç†æ ¸å‡†å¤±æ•—:", error)
          showStatusMessage("è™•ç†ç”³è«‹æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦", "error")
        } finally {
          hideLoading()
        }
      }

      // å¿«é€Ÿæ›´æ–°å–®ç­†è¨˜éŒ„çš„ FromBackCmpyï¼ˆç”¨æ–¼æˆ‘çš„æ ¸å‡†åˆ†é ï¼‰
      async function quickUpdateFromBackCmpy(recordId, fromBackCmpy) {
        try {
          showLoading()

          const response = await fetch(
            `${base_url}Leave/${recordId}/fromback-cmpy`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                approverId: currentUser.userId,
                fromBackCmpy: fromBackCmpy,
              }),
            }
          )

          if (!response.ok) {
            throw new Error(`æ›´æ–°å¤±æ•—`)
          }

          // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
          const typeName =
            fromBackCmpy === "é€•å¾€"
              ? "é€•å¾€"
              : fromBackCmpy === "é€•è¿”"
              ? "é€•è¿”"
              : fromBackCmpy === "é€•å¾€åŠé€•è¿”"
              ? "é€•å¾€åŠé€•è¿”"
              : "ä¸€èˆ¬å…¬å‡º"
          showStatusMessage(`å·²æ›´æ–°ç‚ºã€Œ${typeName}ã€`, "success")

          // é‡æ–°è¼‰å…¥è¨˜éŒ„ä»¥é¡¯ç¤ºæœ€æ–°ç‹€æ…‹
          await loadRecords()
        } catch (error) {
          console.error("æ›´æ–°å¤±æ•—:", error)
          showStatusMessage("æ›´æ–°æ™‚ç™¼ç”ŸéŒ¯èª¤", "error")
        } finally {
          hideLoading()
        }
      }

      // é¡¯ç¤ºæ ¸å‡†ç¢ºèªå°è©±æ¡†
      function showApprovalDialog(recordId, action) {
        const actionText = action === "pass" ? "æ ¸å‡†" : "ä¸æ ¸å‡†"
        const message = `æ‚¨ç¢ºå®šè¦${actionText}æ­¤ç”³è«‹å—ï¼Ÿ`

        showConfirmDialog(message, () => handleApproval(recordId, action))
      }

      // è™•ç†æ ¸å‡†/ä¸æ ¸å‡†æ“ä½œ
      async function handleApproval(recordId, action) {
        try {
          showLoading()

          const approvalData = {
            approverId: currentUser.userId,
            result: action,
            description: action === "pass" ? "æ ¸å‡†" : "ä¸æ ¸å‡†",
          }

          const response = await fetch(`${base_url}Leave/${recordId}/approve`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(approvalData),
          })

          if (response.ok) {
            const actionText = action === "pass" ? "æ ¸å‡†" : "ä¸æ ¸å‡†"
            showStatusMessage(`ç”³è«‹å·²${actionText}`, "success")
            // é‡æ–°è¼‰å…¥è¨˜éŒ„ä»¥æ›´æ–°åˆ—è¡¨
            await loadRecords()
          } else {
            let errorMessage = "æ“ä½œå¤±æ•—"
            try {
              const errorData = await response.json()
              errorMessage = errorData.message || errorMessage
            } catch (parseError) {
              console.error("è§£æéŒ¯èª¤å›æ‡‰å¤±æ•—:", parseError)
            }
            showStatusMessage(errorMessage, "error")
          }
        } catch (error) {
          console.error("æ ¸å‡†æ“ä½œå¤±æ•—:", error)
          showStatusMessage("æ“ä½œæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦", "error")
        } finally {
          hideLoading()
        }
      }
    </script>
  </body>
</html>
