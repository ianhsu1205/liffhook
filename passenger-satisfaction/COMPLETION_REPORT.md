# 大都會客運乘客滿意度調查系統 - 完成報告

## ✅ 已完成的功能

### 1. 後端 API 開發

- **PassengerSatisfactionController**: 完整的問卷提交和管理 API
- **GoogleSheetsService**: Google Sheets 整合服務，支援資料自動寫入
- **PassengerSatisfactionSurvey**: 完整的資料模型定義
- **驗證碼機制**: 數學運算驗證碼防止濫用

### 2. 前端頁面開發

- **響應式設計**: 支援桌機、平板、手機各種裝置
- **美觀的使用者介面**: 漸層色彩、動畫效果、現代化設計
- **完整的表單驗證**: 即時驗證、錯誤提示、必填欄位檢查
- **無障礙設計**: 良好的標籤、對比度、鍵盤導航

### 3. 系統整合

- **路線資料整合**: 自動從現有 TdxRouteInfo API 載入大都會客運路線
- **Google Sheets 存儲**: 問卷結果自動寫入 Google Sheets
- **CORS 配置**: 支援跨域訪問
- **錯誤處理**: 完整的錯誤捕獲和使用者友善提示

### 4. 安全性機制

- **驗證碼保護**: 防止機器人提交
- **輸入驗證**: 前後端雙重驗證
- **SQL 注入防護**: 使用參數化查詢
- **XSS 防護**: 輸入內容過濾

## 📋 問卷結構

### 基本資訊

- 搭車日期 (日期選擇器)
- 搭車時間 (時/分下拉選單)
- 搭乘路線 (動態載入大都會客運路線)
- 駕駛長 (文字輸入)
- 車號 (文字輸入)

### A. 硬體車輛設備 (5 分制單選)

#### (一) 車輛外部整潔

- 車身整潔
- LED、路線牌

#### (二) 車輛內部整潔

- 座椅
- 地板
- 玻璃
- 拉環

#### (三) 車內資訊

- 駕駛長名牌
- 路線圖

#### (四) 設備

- 站名播報器
- 驗票機(刷卡機)
- 冷氣空調
- 燈光亮度
- 車內噪音

### B. 行車安全與服務 (多選)

#### 優良行為

- 行車平穩
- 熱心服務特殊需求乘客
- 服務親切有禮

#### 不良行為

- 無 (特殊選項，選擇後禁用其他選項)
- 未繫安全帶
- 使用手機
- 闖紅燈
- 過站不停
- 不當言論或怒罵
- 暴力行為
- 夾到乘客
- 未禮讓行人
- 吸菸、嚼檳榔
- 轉彎未停車再開
- 任意變換車道
- 態度不佳
- 非站牌區上下乘客
- 行車中聊天
- 其他 (自由輸入)

### C. 其他 (5 分制單選)

- 行車間距
- 候車時間
- 站牌標示

### D. 整體服務滿意

- 本次乘車體驗 (5 分制)
- 是否願意等待本公司班車 (是/否)

## 🚀 部署與使用

### 文件位置

```
backend/wwwroot/passenger-satisfaction/
├── index.html          # 問卷主頁面
├── script.js           # JavaScript 功能
└── README.md           # 使用說明文檔
```

### API 端點

```
GET  /api/PassengerSatisfaction/options   # 獲取選項數據
GET  /api/PassengerSatisfaction/captcha   # 生成驗證碼
POST /api/PassengerSatisfaction           # 提交問卷
POST /api/PassengerSatisfaction/init-sheets # 初始化Google Sheets
```

### 訪問地址

```
http://您的伺服器地址/passenger-satisfaction/
```

## ⚙️ 配置說明

### Google Sheets 設定

1. 在 `appsettings.json` 中設定 Google Sheets ID：

```json
{
  "GoogleSheets": {
    "PassengerSatisfactionSpreadsheetId": "您的Google Sheets ID"
  }
}
```

2. 確保 Google 服務帳戶有 Sheets 編輯權限
3. 運行初始化 API 設定表頭

### 已安裝的 NuGet 套件

- `Google.Apis.Sheets.v4`: Google Sheets API 整合
- `Google.Apis.Auth`: Google 驗證

## 🎨 設計特色

### 視覺設計

- **主色調**: 大都會客運藍色 (#0066cc, #004499)
- **強調色**: 橘色 (#ff6b35)
- **成功色**: 綠色 (#28a745)
- **漸層效果**: 多層次視覺體驗

### 使用者體驗

- **響應式布局**: 自動適應各種螢幕尺寸
- **平滑動畫**: 提升互動體驗
- **即時反饋**: 表單驗證、載入狀態、錯誤提示
- **直觀操作**: 清晰的標籤、邏輯分組、進度引導

### 技術亮點

- **純前端技術**: HTML5、CSS3、ES6+
- **無框架依賴**: 使用原生 JavaScript
- **Bootstrap 整合**: 響應式組件和樣式
- **Font Awesome 圖標**: 豐富的視覺元素

## 📊 資料存儲格式

Google Sheets 欄位結構：

```
提交時間 | 搭車日期 | 搭車時間 | 搭乘路線 | 駕駛長 | 車號 |
車身整潔 | LED路線牌 | 座椅 | 地板 | 玻璃 | 拉環 |
駕駛長名牌 | 路線圖 | 站名播報器 | 驗票機刷卡機 | 冷氣空調 |
燈光亮度 | 車內噪音 | 優良行為 | 不良行為 | 其他不良行為 |
行車間距 | 候車時間 | 站牌標示 | 本次乘車體驗 | 是否願意等待本公司班車
```

## 🔧 疑難排解

### 常見問題

1. **路線載入失敗**: 檢查 TdxRouteInfo API 是否正常
2. **Google Sheets 寫入失敗**: 驗證 Sheets ID 和權限設定
3. **驗證碼無法載入**: 確認 API 端點可訪問
4. **表單提交失敗**: 檢查網路連線和必填欄位

### 系統需求

- **.NET 8.0** 或更高版本
- **PostgreSQL** 資料庫
- **Google Sheets API** 憑證
- **網路連線** (訪問 Google API 和 TDX API)

## 📈 後續擴展建議

### 功能擴展

- **資料分析儀表板**: 滿意度統計圖表
- **報表匯出**: Excel、PDF 格式報表
- **多語言支援**: 英文、日文版本
- **離線支援**: PWA 離線填寫功能

### 技術優化

- **快取機制**: Redis 快取路線資料
- **資料壓縮**: 減少傳輸大小
- **CDN 整合**: 加速靜態資源載入
- **監控系統**: 應用程式效能監控

---

## 🎉 總結

大都會客運乘客滿意度調查系統已經完整開發完成，包含：

✅ **完整的問卷功能** - 涵蓋您要求的所有問題類型  
✅ **美觀的設計** - 響應式、現代化使用者介面  
✅ **Google Sheets 整合** - 自動資料存儲  
✅ **驗證碼保護** - 防止濫用  
✅ **路線整合** - 自動載入大都會客運路線  
✅ **公開訪問** - 無需權限控管  
✅ **完整文檔** - 使用說明和技術文檔

系統已準備好投入使用，只需要配置 Google Sheets ID 即可開始收集乘客滿意度資料。
